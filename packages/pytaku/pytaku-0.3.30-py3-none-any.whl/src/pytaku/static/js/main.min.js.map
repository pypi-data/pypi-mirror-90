{
  "version": 3,
  "sources": ["../../js-src/models.js", "../../js-src/utils.js", "../../js-src/layout.js", "../../js-src/routes/authentication.js", "../../js-src/routes/home.js", "../../js-src/routes/follows.js", "../../js-src/routes/search.js", "../../js-src/routes/title.js", "../../js-src/routes/chapter.js", "../../js-src/routes/importer.js", "../../js-src/main.js"],
  "sourcesContent": ["function readCookie(cookieString) {\n  // This is terrible and wrong but it's enough for what we need i.e. just get\n  // the damn token.\n  const result = {};\n  cookieString.split(\";\").forEach((pair) => {\n    const [key, val] = pair.split(\"=\");\n    result[key] = val;\n  });\n  return result;\n}\n\nconst Auth = {\n  username: sessionStorage.getItem(\"username\"),\n  userId: sessionStorage.getItem(\"userId\"),\n  token: readCookie(document.cookie).token || null,\n  isLoggedIn: () => Auth.username !== null && Auth.userId !== null,\n  init: () => {\n    // Already logged in, probably from another tab:\n    if (Auth.isLoggedIn()) {\n      console.log(\"Already logged in\");\n      return Promise.resolve();\n    }\n\n    // No previous login session:\n    if (Auth.token === null) {\n      console.log(\"No saved token found\");\n      return Promise.resolve();\n    }\n\n    // Verify token saved from previous login session:\n    return m\n      .request({\n        method: \"GET\",\n        url: \"/api/verify-token\",\n      })\n      .then((result) => {\n        // Success! Set user info for this session now\n        sessionStorage.setItem(\"username\", result.username);\n        sessionStorage.setItem(\"userId\", result.user_id);\n        Auth.username = result.username;\n        Auth.userId = result.user_id;\n      })\n      .catch((err) => {\n        // If server responded with 401 Unauthorized, clear any local trace of\n        // these invalid credentials.\n        if (err.code == 401) {\n          Auth.clearCredentials();\n        }\n      })\n      .finally(m.redraw);\n  },\n\n  saveLoginResults: ({ userId, username, token, remember }) => {\n    sessionStorage.setItem(\"userId\", userId);\n    sessionStorage.setItem(\"username\", username);\n    Auth.userId = userId;\n    Auth.username = username;\n    Auth.token = token;\n  },\n\n  logout: () => {\n    return Auth.request({ method: \"POST\", url: \"/api/logout\" })\n      .then(Auth.clearCredentials)\n      .catch((err) => {\n        if (err.code == 401) {\n          Auth.clearCredentials();\n        } else {\n          console.log(err);\n        }\n      });\n  },\n\n  clearCredentials: () => {\n    Auth.username = null;\n    Auth.token = null;\n    Auth.userId = null;\n    sessionStorage.clear();\n  },\n\n  request: (options) => {\n    return m.request(options).catch((err) => {\n      if (err.code == 401) {\n        Auth.clearCredentials();\n      } else if (err.code == 500) {\n        alert(err.response.message);\n      }\n      throw err;\n    });\n  },\n};\n\nconst SearchModel = {\n  query: \"\",\n  result: {},\n  cache: {},\n  isLoading: true,\n  performSearch: (query) => {\n    SearchModel.query = query;\n    if (SearchModel.cache[query]) {\n      SearchModel.result = SearchModel.cache[query];\n    } else {\n      SearchModel.isLoading = true;\n      m.redraw();\n      m.request({\n        method: \"GET\",\n        url: \"/api/search/:query\",\n        params: { query },\n      })\n        .then((resp) => {\n          SearchModel.cache[query] = resp;\n          SearchModel.result = resp;\n        })\n        .catch((err) => {\n          console.log(\"TODO\", err);\n        })\n        .finally(() => {\n          SearchModel.isLoading = false;\n        });\n    }\n  },\n};\n\nconst ChapterModel = {\n  cache: {},\n\n  cacheGet: (site, titleId, chapterId) => {\n    const key = [site, titleId, chapterId].join(\",\");\n    return ChapterModel.cache[key] || null;\n  },\n  cacheSet: (site, titleId, chapterId, value) => {\n    const key = [site, titleId, chapterId].join(\",\");\n    ChapterModel.cache[key] = value;\n  },\n\n  get: ({ site, titleId, chapterId }) => {\n    // Returns a promise.\n    // Tries to return cached data first, if that fails then send http request\n    // and save cache on success.\n\n    const cached = ChapterModel.cacheGet(site, titleId, chapterId);\n    if (cached) {\n      return Promise.resolve(cached);\n    }\n\n    return Auth.request({\n      method: \"GET\",\n      url: \"/api/chapter/:site/:titleId/:chapterId\",\n      params: { site, titleId, chapterId },\n    }).then((chapter) => {\n      ChapterModel.cacheSet(site, titleId, chapterId, chapter);\n      return chapter;\n    });\n  },\n};\n\nexport { Auth, SearchModel, ChapterModel };\n", "const LoadingMessage = {\n  view: (vnode) => m(\"h2.blink\", [m(\"i.icon.icon-loader.spin\"), \" loading...\"]),\n};\n\nconst Button = {\n  view: (vnode) =>\n    m(\n      \"button\",\n      Object.assign({ class: vnode.attrs.color || \"\" }, vnode.attrs),\n      [\n        vnode.attrs.icon ? m(`i.icon.icon-${vnode.attrs.icon}`) : null,\n        vnode.attrs.text ? m(\"span\", vnode.attrs.text) : null,\n      ]\n    ),\n};\n\nconst Chapter = {\n  view: (vnode) =>\n    m(\"div.utils--chapter\", [\n      m(\n        m.route.Link,\n        {\n          href: `/m/${vnode.attrs.site}/${vnode.attrs.titleId}/${vnode.attrs.chapter.id}`,\n          class: \"touch-friendly\",\n        },\n        [\n          vnode.attrs.chapter.is_read\n            ? m(\"i.icon.icon-check-square.utils--chapter--read-icon\")\n            : null,\n          m(\"span\", fullChapterName(vnode.attrs.chapter)),\n          vnode.attrs.chapter.groups.map((group) =>\n            m(\"span.utils--chapter--group\", truncate(group, 20))\n          ),\n        ]\n      ),\n    ]),\n};\n\nfunction truncate(input, size) {\n  return input.length > size ? `${input.substring(0, size)}...` : input;\n}\n\nfunction fullChapterName(chapter) {\n  let result = \"\";\n  if (typeof chapter.num_major !== \"undefined\") {\n    result += (chapter.volume ? \"Ch.\" : \"Chapter \") + chapter.num_major;\n  }\n  if (chapter.num_minor) {\n    result += \".\" + chapter.num_minor;\n  }\n  if (chapter.volume) {\n    result += \" Vol. \" + chapter.volume;\n  }\n  if (chapter.name) {\n    result += \" - \" + chapter.name;\n  }\n  return result;\n}\n\nexport { LoadingMessage, Button, Chapter, truncate, fullChapterName };\n", "import { Auth, SearchModel } from \"./models.js\";\nimport { Button } from \"./utils.js\";\n\nfunction Navbar(initialVNode) {\n  let isLoggingOut = false;\n\n  return {\n    view: (vnode) => {\n      let userLink;\n      if (Auth.isLoggedIn()) {\n        userLink = m(\"span.nav--greeting\", [\n          m(\"span\", [\"Welcome, \", m(\"b\", Auth.username)]),\n          m(Button, {\n            text: isLoggingOut ? \" logging out\" : \" logout\",\n            icon: \"log-out\",\n            color: \"red\",\n            title: \"Log out\",\n            onclick: (ev) => {\n              isLoggingOut = true;\n              m.redraw();\n              Auth.logout()\n                .then(() => {\n                  m.route.set(\"/\");\n                })\n                .finally(() => {\n                  isLoggingOut = false;\n                });\n            },\n            disabled: isLoggingOut ? \"disabled\" : null,\n          }),\n        ]);\n      } else {\n        userLink = m(m.route.Link, { class: \"nav--link\", href: \"/a\" }, [\n          m(\"i.icon.icon-log-in\"),\n          \"login / register\",\n        ]);\n      }\n\n      return m(\"nav\", [\n        m(\n          m.route.Link,\n          { class: \"nav--logo\", href: Auth.isLoggedIn() ? \"/f\" : \"/\" },\n          [\n            m(\"img.nav--logo--favicon\", {\n              src: \"/static/favicon.svg\",\n              alt: \"home\",\n            }),\n            m(\"img.nav--logo--img\", {\n              src: \"/static/pytaku.svg\",\n              alt: \"home\",\n            }),\n          ]\n        ),\n        m(\n          \"form.nav--search-form\",\n          {\n            onsubmit: (ev) => {\n              ev.preventDefault();\n              m.route.set(\"/s/:query\", { query: SearchModel.query });\n            },\n          },\n          [\n            m(\"input[placeholder=search manga title]\", {\n              onchange: (ev) => {\n                SearchModel.query = ev.target.value;\n              },\n              value: SearchModel.query,\n            }),\n            m(Button, { color: \"red\", icon: \"search\", type: \"submit\" }),\n          ]\n        ),\n        userLink,\n      ]);\n    },\n  };\n}\n\nconst Layout = {\n  view: (vnode) => {\n    return [m(Navbar), vnode.children];\n  },\n};\n\nexport default Layout;\n", "import { Auth } from \"../models.js\";\nimport { Button } from \"../utils.js\";\n\nfunction Authentication(initialVNode) {\n  let loginUsername;\n  let loginPassword;\n  let rememberMe = false;\n  let loginErrorMessage;\n  let registerUsername;\n  let registerPassword;\n  let confirmPassword;\n  let registerMessage;\n  let registerSuccess;\n\n  let registering = false;\n  let loggingIn = false;\n\n  return {\n    oncreate: (vnode) => {\n      document.title = \"Authentication - Pytaku\";\n    },\n    view: (vnode) => {\n      return m(\"div.content.auth\", [\n        m(\n          \"form.auth--form\",\n          {\n            onsubmit: (e) => {\n              e.preventDefault();\n              loginErrorMessage = \"\";\n              loggingIn = true;\n              m.redraw();\n\n              m.request({\n                method: \"POST\",\n                url: \"/api/login\",\n                body: {\n                  username: loginUsername,\n                  password: loginPassword,\n                  remember: rememberMe,\n                },\n              })\n                .then((result) => {\n                  let userId = result.user_id;\n                  let token = result.token;\n                  let username = loginUsername;\n                  Auth.saveLoginResults({\n                    userId,\n                    username,\n                    token,\n                    remember: rememberMe,\n                  });\n                  m.route.set(\"/f\");\n                })\n                .catch((e) => {\n                  loginErrorMessage = e.response.message;\n                })\n                .finally(() => {\n                  loggingIn = false;\n                });\n            },\n          },\n          [\n            m(\"h1\", \"Login\"),\n            m(\"input[placeholder=username][name=username][required]\", {\n              value: loginUsername,\n              oninput: (e) => {\n                loginUsername = e.target.value;\n              },\n            }),\n            m(\n              \"input[placeholder=password][name=password][type=password][required]\",\n              {\n                value: loginPassword,\n                oninput: (e) => {\n                  loginPassword = e.target.value;\n                },\n              }\n            ),\n            m(\"label[for=auth--remember].auth--checkbox-label\", [\n              m(\"input[type=checkbox][name=remember][id=auth--remember]\", {\n                checked: rememberMe,\n                onchange: (e) => {\n                  rememberMe = e.target.checked;\n                },\n              }),\n              \" Remember me\",\n            ]),\n            m(Button, {\n              type: \"submit\",\n              disabled: loggingIn ? \"disabled\" : null,\n              text: loggingIn ? \" Logging in...\" : \" Log in\",\n              icon: \"log-in\",\n              color: \"blue\",\n            }),\n            m(\"p.auth--form--error-message\", loginErrorMessage),\n          ]\n        ),\n        m(\n          \"form.auth--form\",\n          {\n            onsubmit: (e) => {\n              e.preventDefault();\n              registerMessage = \"\";\n              m.redraw();\n\n              if (registerPassword !== confirmPassword) {\n                registerMessage = \"Password confirmation didn't match!\";\n                registerSuccess = false;\n                return;\n              }\n\n              registering = true;\n              m.redraw();\n              m.request({\n                method: \"POST\",\n                url: \"/api/register\",\n                body: {\n                  username: registerUsername,\n                  password: registerPassword,\n                },\n              })\n                .then((result) => {\n                  registerSuccess = true;\n                  registerMessage = result.message;\n                  loginUsername = registerUsername;\n                  loginPassword = registerPassword;\n                })\n                .catch((e) => {\n                  registerMessage = e.response.message;\n                  registerSuccess = false;\n                })\n                .finally(() => {\n                  registering = false;\n                });\n            },\n          },\n          [\n            m(\"h1\", \"Register\"),\n            m(\"input[placeholder=username][name=username][required]\", {\n              value: registerUsername,\n              oninput: (e) => {\n                registerUsername = e.target.value;\n              },\n            }),\n            m(\n              \"input[placeholder=password][name=password][type=password][required]\",\n              {\n                value: registerPassword,\n                oninput: (e) => {\n                  registerPassword = e.target.value;\n                },\n              }\n            ),\n            m(\n              \"input[placeholder=confirm password][name=confirm][type=password][required]\",\n              {\n                value: confirmPassword,\n                oninput: (e) => {\n                  confirmPassword = e.target.value;\n                },\n              }\n            ),\n            m(Button, {\n              type: \"submit\",\n              disabled: registering ? \"disabled\" : null,\n              text: registering ? \" Registering...\" : \" Register\",\n              icon: \"user-plus\",\n              color: \"green\",\n            }),\n            m(\n              \"p\",\n              {\n                class:\n                  \"auth--form--message-\" +\n                  (registerSuccess ? \"success\" : \"error\"),\n              },\n              registerMessage\n            ),\n          ]\n        ),\n      ]);\n    },\n  };\n}\n\nexport default Authentication;\n", "const Home = {\n  oncreate: (vnode) => {\n    document.title = \"Pytaku\";\n  },\n  view: (vnode) => {\n    return m(\"div.content\", [\n      m(\"p\", \"Try searching for some manga title using the box above.\"),\n      m(\"p\", \"Logging in allows you to follow manga titles.\"),\n    ]);\n  },\n};\n\nexport default Home;\n", "import { Auth } from \"../models.js\";\nimport { LoadingMessage, fullChapterName, Chapter } from \"../utils.js\";\n\nconst Title = {\n  view: (vnode) => {\n    const title = vnode.attrs.title;\n    const numChaptersToDisplay = 3;\n\n    return m(\n      \"div.follows--title\" +\n        (title.chapters.length === 0 ? \".empty\" : \".non-empty\"),\n      [\n        m(\"div\", [\n          m(\n            m.route.Link,\n            {\n              href: `/m/${title.site}/${title.id}`,\n              title: `${title.name} - ${title.site}`,\n            },\n            [m(\"img.follows--cover\", { src: title.thumbnail, alt: title.name })]\n          ),\n        ]),\n        m(\"div.follows--chapters\", [\n          title.chapters.length > numChaptersToDisplay\n            ? m(\n                m.route.Link,\n                {\n                  href: `/m/${title.site}/${title.id}`,\n                  class: \"follows--chapter follows--more\",\n                },\n                `and ${title.chapters.length - numChaptersToDisplay} more...`\n              )\n            : \"\",\n          title.chapters\n            .slice(-numChaptersToDisplay)\n            .map((chapter) =>\n              m(Chapter, { site: title.site, titleId: title.id, chapter })\n            ),\n        ]),\n      ]\n    );\n  },\n};\n\nfunction Follows(initialVNode) {\n  let titles = [];\n  let isLoading = false;\n\n  return {\n    oninit: () => {\n      isLoading = true;\n      Auth.request({\n        method: \"GET\",\n        url: \"/api/follows\",\n      })\n        .then((resp) => {\n          titles = resp.titles;\n        })\n        .catch((err) => {\n          console.log(err);\n        })\n        .finally(() => {\n          isLoading = false;\n        });\n    },\n\n    oncreate: (vnode) => {\n      document.title = \"Stuff I follow - Pytaku\";\n    },\n\n    view: (vnode) => {\n      let content = \"\";\n\n      if (isLoading) {\n        return m(\"div.content\", m(LoadingMessage));\n      }\n\n      if (titles.length === 0) {\n        return m(\"div.content\", [\n          m(\"p\", \"You're not following any title yet. Try searching for some.\"),\n          m(\"p\", [\n            \"Migrating from Tachiyomi? \",\n            m(m.route.Link, { href: \"/i\" }, \"Use the importer\"),\n            \"!\",\n          ]),\n        ]);\n      }\n\n      return m(\"div.follows.content\", [\n        titles.map((title) => m(Title, { title })),\n      ]);\n    },\n  };\n}\n\nexport default Follows;\n", "import { Auth, SearchModel } from \"../models.js\";\nimport { LoadingMessage, truncate } from \"../utils.js\";\n\nconst Search = {\n  oninit: (vnode) => {\n    document.title = `\"${vnode.attrs.query}\" search results`;\n    SearchModel.performSearch(vnode.attrs.query);\n  },\n  view: (vnode) => {\n    return m(\n      \"div.content\",\n      SearchModel.isLoading\n        ? m(LoadingMessage)\n        : Object.entries(SearchModel.result).map(([site, titles]) =>\n            m(\"div\", [\n              m(\"h1.search--site-heading\", site),\n              titles\n                ? m(\"p.search--result-text\", [\n                    \"Showing \",\n                    m(\"strong\", titles.length),\n                    ` result${titles.length > 1 ? \"s\" : \"\"} for `,\n                    SearchModel.query,\n                  ])\n                : m(\n                    \"p.search--result-text\",\n                    `No results for \"${SearchModel.query}\"`\n                  ),\n              m(\n                \"div.search--results\",\n                titles.map((title) =>\n                  m(\n                    m.route.Link,\n                    {\n                      class: \"search--result\",\n                      href: `/m/${site}/${title.id}`,\n                      title: title.name,\n                    },\n                    [\n                      m(\"img\", { src: title.thumbnail, alt: title.name }),\n                      m(\"span\", truncate(title.name, 50)),\n                    ]\n                  )\n                )\n              ),\n            ])\n          )\n    );\n  },\n};\n\nexport default Search;\n", "import { Auth } from \"../models.js\";\nimport { LoadingMessage, Button, fullChapterName, Chapter } from \"../utils.js\";\n\nfunction Title(initialVNode) {\n  let isLoading = false;\n  let isTogglingFollow = false;\n  let isMarkingAllAsRead = false;\n  let title = {};\n  let allAreRead;\n\n  return {\n    oninit: (vnode) => {\n      document.title = \"Manga\";\n      isLoading = true;\n      m.redraw();\n\n      Auth.request({\n        method: \"GET\",\n        url: \"/api/title/:site/:titleId\",\n        params: {\n          site: vnode.attrs.site,\n          titleId: vnode.attrs.titleId,\n        },\n      })\n        .then((resp) => {\n          title = resp;\n          document.title = title.name;\n        })\n        .finally(() => {\n          isLoading = false;\n        });\n    },\n    view: (vnode) => {\n      if (!isLoading && Auth.isLoggedIn()) {\n        allAreRead = true;\n        for (let chap of title.chapters) {\n          if (!chap.is_read) {\n            allAreRead = false;\n            break;\n          }\n        }\n      }\n      return m(\n        \"div.content\",\n        isLoading\n          ? m(LoadingMessage)\n          : [\n              m(\"h1\", title.name),\n              m(\"div.title--details\", [\n                Auth.isLoggedIn()\n                  ? [\n                      m(Button, {\n                        icon: \"bookmark\",\n                        disabled: isTogglingFollow ? \"disabled\" : null,\n                        text: isTogglingFollow\n                          ? \"submitting...\"\n                          : title.is_following\n                          ? \"following\"\n                          : \"follow\",\n                        color: title.is_following ? \"red\" : \"green\",\n                        title: title.is_following\n                          ? \"Click to unfollow\"\n                          : \"Click to follow\",\n                        onclick: (ev) => {\n                          isTogglingFollow = true;\n                          m.redraw();\n                          Auth.request({\n                            method: \"POST\",\n                            url: \"/api/follow\",\n                            body: {\n                              site: title.site,\n                              title_id: title.id,\n                              follow: !title.is_following,\n                            },\n                          })\n                            .then((resp) => {\n                              title.is_following = resp.follow;\n                            })\n                            .finally(() => {\n                              isTogglingFollow = false;\n                            });\n                        },\n                      }),\n                      m(Button, {\n                        icon: \"check-square\",\n                        disabled:\n                          isMarkingAllAsRead || allAreRead ? \"disabled\" : null,\n                        text: isMarkingAllAsRead\n                          ? \"submitting...\"\n                          : allAreRead\n                          ? \"all read!\"\n                          : \"read all\",\n                        color: \"green\",\n                        title: allAreRead\n                          ? null\n                          : \"Click to mark all chapters as read\",\n                        onclick: (ev) => {\n                          isMarkingAllAsRead = true;\n                          m.redraw();\n                          Auth.request({\n                            method: \"POST\",\n                            url: \"/api/read\",\n                            body: {\n                              read: title.chapters\n                                .filter((ch) => !ch.is_read)\n                                .map((ch) => {\n                                  return {\n                                    site: title.site,\n                                    title_id: title.id,\n                                    chapter_id: ch.id,\n                                  };\n                                }),\n                            },\n                          })\n                            .then((resp) => {\n                              title.chapters.forEach((chap) => {\n                                chap.is_read = true;\n                              });\n                            })\n                            .finally(() => {\n                              isMarkingAllAsRead = false;\n                            });\n                        },\n                      }),\n                    ]\n                  : null,\n                m(\n                  \"a.touch-friendly[title=Go to source site][target=_blank]\",\n                  { href: title.source_url },\n                  [title.site, m(\"i.icon.icon-arrow-up-right\")]\n                ),\n              ]),\n              m(\"img.title--cover[alt=cover]\", { src: title.cover }),\n              title.descriptions.map((desc) => m(\"p\", desc)),\n              title.chapters\n                ? title.chapters.map((chapter) =>\n                    m(Chapter, { site: title.site, titleId: title.id, chapter })\n                  )\n                : m(\"p\", \"This one has no chapters.\"),\n            ]\n      );\n    },\n  };\n}\n\nexport default Title;\n", "import { Auth, ChapterModel } from \"../models.js\";\nimport { LoadingMessage, fullChapterName, Button } from \"../utils.js\";\n\nconst LoadingPlaceholder = {\n  view: () => m(\"h2\", [m(\"i.icon.icon-loader.spin\")]),\n};\n\nconst PendingPlaceholder = {\n  view: () => m(\"h2\", [m(\"i.icon.icon-loader\")]),\n};\n\nconst RetryImgButton = {\n  view: (vnode) => {\n    return m(Button, {\n      text: \"Errored. Try again?\",\n      color: \"red\",\n      onclick: (ev) => {\n        const { page } = vnode.attrs;\n        page.status = ImgStatus.LOADING;\n        // Cheat: append to src so the element's key is\n        // different, forcing mithril to redraw.\n        // Chose `?` here because it will just be stripped by\n        // flask's path parser.\n        page.src = page.src.endsWith(\"?\")\n          ? page.src.slice(0, -1)\n          : page.src + \"?\";\n      },\n    });\n  },\n};\n\nconst ImgStatus = {\n  LOADING: \"loading\",\n  SUCCEEDED: \"succeeded\",\n  FAILED: \"failed\",\n};\n\nfunction FallbackableImg(initialVNode) {\n  let currentSrc;\n  return {\n    oninit: (vnode) => {\n      currentSrc = vnode.attrs.src;\n    },\n    view: (vnode) => {\n      return m(\"img\", {\n        src: currentSrc,\n        style: vnode.attrs.style,\n        onload: vnode.attrs.onload,\n        onerror: (ev) => {\n          if (currentSrc === vnode.attrs.src && vnode.attrs.altsrc !== null) {\n            currentSrc = vnode.attrs.altsrc;\n          } else {\n            vnode.attrs.onerror(ev);\n          }\n        },\n      });\n    },\n  };\n}\n\nfunction Chapter(initialVNode) {\n  let isLoading = false;\n  let chapter = {};\n  let loadedPages = [];\n  let pendingPages = [];\n\n  let site, titleId; // these are written on init\n  let nextChapterPromise = null;\n  let nextChapterPendingPages = null;\n  let nextChapterLoadedPages = [];\n\n  function loadNextPage() {\n    if (pendingPages.length > 0) {\n      let [src, altsrc] = pendingPages.splice(0, 1)[0];\n      loadedPages.push({\n        status: ImgStatus.LOADING,\n        src,\n        altsrc,\n      });\n    } else if (chapter.next_chapter && nextChapterPromise === null) {\n      /* Once all pages of this chapter have been loaded,\n       * preload the next chapter\n       */\n      nextChapterPromise = ChapterModel.get({\n        site,\n        titleId,\n        chapterId: chapter.next_chapter.id,\n      }).then((nextChapter) => {\n        console.log(\"Preloading next chapter:\", fullChapterName(nextChapter));\n        if (nextChapter.pages_alt.length > 0) {\n          nextChapterPendingPages = nextChapter.pages.map((page, i) => {\n            return [page, nextChapter.pages_alt[i]];\n          });\n        } else {\n          nextChapterPendingPages = nextChapter.pages.map((page) => {\n            return [page, null];\n          });\n        }\n        // Apparently preloading one at a time was too slow so let's go with 2.\n        preloadNextChapterPage();\n        preloadNextChapterPage();\n      });\n    }\n  }\n\n  function preloadNextChapterPage() {\n    if (nextChapterPendingPages !== null) {\n      if (nextChapterPendingPages.length > 0) {\n        const [src, altsrc] = nextChapterPendingPages.splice(0, 1)[0];\n        nextChapterLoadedPages.push({ src, altsrc });\n      }\n    }\n  }\n\n  return {\n    oninit: (vnode) => {\n      document.title = \"Manga chapter\";\n      site = vnode.attrs.site;\n      titleId = vnode.attrs.titleId;\n\n      isLoading = true;\n      m.redraw();\n\n      ChapterModel.get({\n        site: vnode.attrs.site,\n        titleId: vnode.attrs.titleId,\n        chapterId: vnode.attrs.chapterId,\n      })\n        .then((resp) => {\n          chapter = resp;\n          document.title = fullChapterName(chapter);\n\n          // \"zip\" pages & pages_alt into pendingPages\n          if (chapter.pages_alt.length > 0) {\n            pendingPages = chapter.pages.map((page, i) => {\n              return [page, chapter.pages_alt[i]];\n            });\n          } else {\n            pendingPages = chapter.pages.map((page) => {\n              return [page, null];\n            });\n          }\n\n          // start loading pages, 3 at a time:\n          loadNextPage();\n          loadNextPage();\n          loadNextPage();\n        })\n        .finally(() => {\n          isLoading = false;\n        });\n    },\n    view: (vnode) => {\n      if (isLoading) {\n        return m(\"div.chapter.content\", m(LoadingMessage));\n      }\n\n      const { site, titleId } = vnode.attrs;\n      const prev = chapter.prev_chapter;\n      const next = chapter.next_chapter;\n      const buttons = m(\"div.chapter--buttons\", [\n        prev\n          ? m(\n              m.route.Link,\n              {\n                class: \"touch-friendly\",\n                href: `/m/${site}/${titleId}/${prev.id}`,\n              },\n              [m(\"i.icon.icon-chevrons-left\"), m(\"span\", \"prev\")]\n            )\n          : m(Button, {\n              text: \"prev\",\n              icon: \"chevrons-left\",\n              disabled: true,\n            }),\n        m(\n          m.route.Link,\n          {\n            class: \"touch-friendly\",\n            href: `/m/${site}/${titleId}`,\n          },\n          [m(\"i.icon.icon-list\"), m(\"span\", \" chapter list\")]\n        ),\n        m(\n          m.route.Link,\n          {\n            class: \"touch-friendly\",\n            href: next\n              ? `/m/${site}/${titleId}/${next.id}`\n              : `/m/${site}/${titleId}`,\n            onclick: (ev) => {\n              if (Auth.isLoggedIn()) {\n                Auth.request({\n                  method: \"POST\",\n                  url: \"/api/read\",\n                  body: {\n                    read: [\n                      {\n                        site,\n                        title_id: titleId,\n                        chapter_id: chapter.id,\n                      },\n                    ],\n                  },\n                });\n              }\n              return true;\n            },\n          },\n          [\n            m(\"span\", next ? \"next\" : \"finish\"),\n            m(\"i.icon.icon-\" + (next ? \"chevrons-right\" : \"check-circle\")),\n          ]\n        ),\n      ]);\n      return m(\"div.chapter.content\", [\n        m(\"h1\", fullChapterName(chapter)),\n        buttons,\n        m(\n          \"div\",\n          {\n            class:\n              \"chapter--pages\" +\n              (chapter.is_webtoon ? \" chapter--webtoon\" : \"\"),\n          },\n          [\n            loadedPages.map((page, pageIndex) =>\n              m(\"div\", { key: page.src }, [\n                m(FallbackableImg, {\n                  src: page.src,\n                  altsrc: page.altsrc,\n                  style: {\n                    display:\n                      page.status === ImgStatus.SUCCEEDED ? \"block\" : \"none\",\n                  },\n                  onload: (ev) => {\n                    page.status = ImgStatus.SUCCEEDED;\n                    loadNextPage();\n                  },\n                  onerror: (ev) => {\n                    page.status = ImgStatus.FAILED;\n                    loadNextPage();\n                  },\n                }),\n                page.status === ImgStatus.LOADING\n                  ? m(LoadingPlaceholder)\n                  : null,\n                page.status === ImgStatus.FAILED\n                  ? m(\n                      \"div\",\n                      { style: { \"margin-bottom\": \".5rem\" } },\n                      m(RetryImgButton, { page })\n                    )\n                  : null,\n              ])\n            ),\n            pendingPages.map(() => m(PendingPlaceholder)),\n          ]\n        ),\n        buttons,\n        nextChapterLoadedPages.map((page) =>\n          m(FallbackableImg, {\n            style: { display: \"none\" },\n            onload: preloadNextChapterPage,\n            onerror: preloadNextChapterPage,\n            src: page.src,\n            altsrc: page.altsrc,\n          })\n        ),\n      ]);\n    },\n  };\n}\n\nexport default Chapter;\n", "import { Auth } from \"../models.js\";\nimport { Button } from \"../utils.js\";\n\nfunction Importer(initialVNode) {\n  let resultMessage = null;\n  let isSuccess = null;\n  let isUploading = false;\n\n  return {\n    oninit: (vnode) => {\n      document.title = \"Import from Tachiyomi\";\n    },\n    view: (vnode) => {\n      return m(\"div.content\", [\n        m(\"h1\", \"Importing from Tachiyomi\"),\n        m(\n          \"form[enctype=multipart/form-data]\",\n          {\n            onsubmit: (ev) => {\n              ev.preventDefault();\n              // prepare multipart form body\n              const file = document.getElementById(\"tachiyomi\").files[0];\n              const body = new FormData();\n              body.append(\"tachiyomi\", file);\n\n              isUploading = true;\n              resultMessage = null;\n              m.redraw();\n              Auth.request({\n                method: \"POST\",\n                url: \"/api/import\",\n                body,\n              })\n                .then((resp) => {\n                  resultMessage = resp.message;\n                  isSuccess = true;\n                })\n                .catch((err) => {\n                  resultMessage = err.response.message;\n                  isSuccess = false;\n                })\n                .finally(() => {\n                  isUploading = false;\n                });\n            },\n          },\n          [\n            m(\"p\", [\n              \"Go to \",\n              m(\"b\", \"Settings > Backup > Create backup\"),\n              \", then upload the generated json file here:\",\n            ]),\n            m(\"input[type=file][id=tachiyomi].importer--filepicker\"),\n            m(\"br\"),\n            m(Button, {\n              type: \"submit\",\n              text: isUploading ? \"uploading...\" : \"upload\",\n              color: \"green\",\n              icon: \"upload\",\n              disabled: isUploading ? \"disabled\" : null,\n            }),\n          ]\n        ),\n        m(\n          \"p\",\n          { class: `importer--${isSuccess ? \"success\" : \"failure\"}` },\n          resultMessage\n        ),\n        isSuccess\n          ? m(m.route.Link, { href: \"/f\" }, \"See your following list here.\")\n          : null,\n      ]);\n    },\n  };\n}\n\nexport default Importer;\n", "import { Auth } from \"./models.js\";\nimport Layout from \"./layout.js\";\nimport Authentication from \"./routes/authentication.js\";\nimport Home from \"./routes/home.js\";\nimport Follows from \"./routes/follows.js\";\nimport Search from \"./routes/search.js\";\nimport Title from \"./routes/title.js\";\nimport Chapter from \"./routes/chapter.js\";\nimport Importer from \"./routes/importer.js\";\n\nAuth.init().then(() => {\n  const root = document.getElementById(\"spa-root\");\n  m.route.prefix = \"\";\n  m.route(root, \"/\", {\n    \"/\": {\n      onmatch: () => {\n        if (Auth.isLoggedIn()) {\n          m.route.set(\"/f\", null, { replace: true });\n        } else {\n          return Home;\n        }\n      },\n      render: (vnode) => m(Layout, vnode),\n    },\n    \"/a\": {\n      onmatch: () => {\n        if (Auth.isLoggedIn()) {\n          m.route.set(\"/f\", null, { replace: true });\n        } else {\n          return Authentication;\n        }\n      },\n      render: (vnode) => m(Layout, vnode),\n    },\n    \"/f\": {\n      onmatch: () => {\n        if (Auth.isLoggedIn()) {\n          return Follows;\n        } else {\n          m.route.set(\"/a\", null, { replace: true });\n        }\n      },\n      render: (vnode) => m(Layout, vnode),\n    },\n    \"/s/:query\": {\n      render: (vnode) =>\n        m(\n          Layout,\n          m(Search, {\n            query: vnode.attrs.query,\n            key: vnode.attrs.query,\n            // ^ set a key here to reinitialize Search component on route\n            // change. Without it, Search.oninit would only trigger once on\n            // first full page load.\n          })\n        ),\n    },\n    \"/m/:site/:titleId\": {\n      render: (vnode) =>\n        m(\n          Layout,\n          m(Title, {\n            site: vnode.attrs.site,\n            titleId: vnode.attrs.titleId,\n          })\n        ),\n    },\n    \"/m/:site/:titleId/:chapterId\": {\n      render: (vnode) =>\n        m(\n          Layout,\n          m(Chapter, {\n            site: vnode.attrs.site,\n            titleId: vnode.attrs.titleId,\n            chapterId: vnode.attrs.chapterId,\n            key: vnode.attrs.chapterId,\n          })\n        ),\n    },\n    \"/i\": {\n      onmatch: () => {\n        if (Auth.isLoggedIn()) {\n          return Importer;\n        } else {\n          m.route.set(\"/a\", null, { replace: true });\n        }\n      },\n      render: (vnode) => m(Layout, vnode),\n    },\n  });\n});\n"],
  "mappings": "MAAA,WAAoB,GAGlB,MAAe,GACf,SAAa,MAAM,KAAK,QAAQ,IAC9B,SAAmB,EAAK,MAAM,KAC9B,EAAO,GAAO,IAET,EAGT,MAAa,CACX,SAAU,eAAe,QAAQ,YACjC,OAAQ,eAAe,QAAQ,UAC/B,MAAO,EAAW,SAAS,QAAQ,OAAS,KAC5C,WAAY,IAAM,EAAK,WAAa,MAAQ,EAAK,SAAW,KAC5D,KAAM,IAEA,EAAK,aACP,SAAQ,IAAI,qBACL,QAAQ,WAIb,EAAK,QAAU,KACjB,SAAQ,IAAI,wBACL,QAAQ,WAIV,EACJ,QAAQ,CACP,OAAQ,MACR,IAAK,sBAEN,KAAK,IAEJ,eAAe,QAAQ,WAAY,EAAO,UAC1C,eAAe,QAAQ,SAAU,EAAO,SACxC,EAAK,SAAW,EAAO,SACvB,EAAK,OAAS,EAAO,UAEtB,MAAM,IAGL,AAAI,EAAI,MAAQ,KACd,EAAK,qBAGR,QAAQ,EAAE,QAGf,iBAAkB,EAAG,SAAQ,WAAU,QAAO,eAC5C,eAAe,QAAQ,SAAU,GACjC,eAAe,QAAQ,WAAY,GACnC,EAAK,OAAS,EACd,EAAK,SAAW,EAChB,EAAK,MAAQ,GAGf,OAAQ,IACC,EAAK,QAAQ,CAAE,OAAQ,OAAQ,IAAK,gBACxC,KAAK,EAAK,kBACV,MAAM,IACL,AAAI,EAAI,MAAQ,IACd,EAAK,mBAEL,QAAQ,IAAI,KAKpB,iBAAkB,KAChB,EAAK,SAAW,KAChB,EAAK,MAAQ,KACb,EAAK,OAAS,KACd,eAAe,SAGjB,QAAS,GACA,EAAE,QAAQ,GAAS,MAAM,IAC9B,KAAI,GAAI,MAAQ,IACd,EAAK,mBACA,AAAI,EAAI,MAAQ,KACrB,MAAM,EAAI,SAAS,SAEf,OAKQ,CAClB,MAAO,GACP,OAAQ,GACR,MAAO,GACP,UAAW,GACX,cAAe,IACb,EAAY,MAAQ,EACpB,AAAI,EAAY,MAAM,GACpB,EAAY,OAAS,EAAY,MAAM,GAEvC,GAAY,UAAY,GACxB,EAAE,SACF,EAAE,QAAQ,CACR,OAAQ,MACR,IAAK,qBACL,OAAQ,CAAE,WAET,KAAK,IACJ,EAAY,MAAM,GAAS,EAC3B,EAAY,OAAS,IAEtB,MAAM,IACL,QAAQ,IAAI,OAAQ,KAErB,QAAQ,KACP,EAAY,UAAY,UAMb,CACnB,MAAO,GAEP,SAAU,UACR,MAAY,CAAC,EAAM,EAAS,GAAW,KAAK,KAC5C,MAAO,GAAa,MAAM,IAAQ,MAEpC,SAAU,YACR,MAAY,CAAC,EAAM,EAAS,GAAW,KAAK,KAC5C,EAAa,MAAM,GAAO,GAG5B,IAAK,EAAG,OAAM,UAAS,gBAKrB,MAAe,EAAa,SAAS,EAAM,EAAS,GACpD,MAAI,GACK,QAAQ,QAAQ,GAGlB,EAAK,QAAQ,CAClB,OAAQ,MACR,IAAK,yCACL,OAAQ,CAAE,OAAM,UAAS,eACxB,KAAK,GACN,GAAa,SAAS,EAAM,EAAS,EAAW,GACzC,MCtJP,EAAiB,CACrB,KAAM,GAAW,EAAE,WAAY,CAAC,EAAE,2BAA4B,mBAGjD,CACb,KAAM,GACJ,EACE,SACA,OAAO,OAAO,CAAE,MAAO,EAAM,MAAM,OAAS,IAAM,EAAM,OACxD,CACE,EAAM,MAAM,KAAO,EAAE,eAAe,EAAM,MAAM,QAAU,KAC1D,EAAM,MAAM,KAAO,EAAE,OAAQ,EAAM,MAAM,MAAQ,UAKzC,CACd,KAAM,GACJ,EAAE,qBAAsB,CACtB,EACE,EAAE,MAAM,KACR,CACE,KAAM,MAAM,EAAM,MAAM,QAAQ,EAAM,MAAM,WAAW,EAAM,MAAM,QAAQ,KAC3E,MAAO,kBAET,CACE,EAAM,MAAM,QAAQ,QAChB,EAAE,sDACF,KACJ,EAAE,OAAQ,EAAgB,EAAM,MAAM,UACtC,EAAM,MAAM,QAAQ,OAAO,IAAI,GAC7B,EAAE,6BAA8B,EAAS,EAAO,WAO5D,gBACE,MAAO,GAAM,OAAS,EAAO,GAAG,EAAM,UAAU,EAAG,QAAa,EAGlE,cACE,MAAa,GACb,MAAI,OAAO,GAAQ,WAAc,aAC/B,IAAW,GAAQ,OAAS,MAAQ,YAAc,EAAQ,WAE5D,AAAI,EAAQ,WACV,IAAU,IAAM,EAAQ,WAE1B,AAAI,EAAQ,QACV,IAAU,SAAW,EAAQ,QAE/B,AAAI,EAAQ,MACV,IAAU,MAAQ,EAAQ,MAErB,ECrDT,WAAgB,GACd,MAAmB,GAEnB,MAAO,CACL,KAAM,IACJ,MACA,MAAI,GAAK,aACP,EAAW,EAAE,qBAAsB,CACjC,EAAE,OAAQ,CAAC,YAAa,EAAE,IAAK,EAAK,YACpC,EAAE,EAAQ,CACR,KAAM,EAAe,eAAiB,UACtC,KAAM,UACN,MAAO,MACP,MAAO,UACP,QAAS,IACP,EAAe,GACf,EAAE,SACF,EAAK,SACF,KAAK,KACJ,EAAE,MAAM,IAAI,OAEb,QAAQ,KACP,EAAe,MAGrB,SAAU,EAAe,WAAa,SAI1C,EAAW,EAAE,EAAE,MAAM,KAAM,CAAE,MAAO,YAAa,KAAM,MAAQ,CAC7D,EAAE,sBACF,qBAIG,EAAE,MAAO,CACd,EACE,EAAE,MAAM,KACR,CAAE,MAAO,YAAa,KAAM,EAAK,aAAe,KAAO,KACvD,CACE,EAAE,yBAA0B,CAC1B,IAAK,sBACL,IAAK,SAEP,EAAE,qBAAsB,CACtB,IAAK,qBACL,IAAK,WAIX,EACE,wBACA,CACE,SAAU,IACR,EAAG,iBACH,EAAE,MAAM,IAAI,YAAa,CAAE,MAAO,EAAY,UAGlD,CACE,EAAE,wCAAyC,CACzC,SAAU,IACR,EAAY,MAAQ,EAAG,OAAO,OAEhC,MAAO,EAAY,QAErB,EAAE,EAAQ,CAAE,MAAO,MAAO,KAAM,SAAU,KAAM,aAGpD,MAMR,MAAe,CACb,KAAM,GACG,CAAC,EAAE,GAAS,EAAM,aAId,EChFf,WAAwB,GACtB,UAEiB,iBAQC,KACF,GAEhB,MAAO,CACL,SAAU,IACR,SAAS,MAAQ,2BAEnB,KAAM,GACG,EAAE,mBAAoB,CAC3B,EACE,kBACA,CACE,SAAU,IACR,EAAE,iBACF,EAAoB,GACpB,EAAY,GACZ,EAAE,SAEF,EAAE,QAAQ,CACR,OAAQ,OACR,IAAK,aACL,KAAM,CACJ,SAAU,EACV,SAAU,EACV,SAAU,KAGX,KAAK,IACJ,MAAa,EAAO,UACR,EAAO,QACJ,EACf,EAAK,iBAAiB,CACpB,SACA,WACA,QACA,SAAU,IAEZ,EAAE,MAAM,IAAI,QAEb,MAAM,IACL,EAAoB,EAAE,SAAS,UAEhC,QAAQ,KACP,EAAY,OAIpB,CACE,EAAE,KAAM,SACR,EAAE,uDAAwD,CACxD,MAAO,EACP,QAAS,IACP,EAAgB,EAAE,OAAO,SAG7B,EACE,sEACA,CACE,MAAO,EACP,QAAS,IACP,EAAgB,EAAE,OAAO,SAI/B,EAAE,iDAAkD,CAClD,EAAE,yDAA0D,CAC1D,QAAS,EACT,SAAU,IACR,EAAa,EAAE,OAAO,WAG1B,iBAEF,EAAE,EAAQ,CACR,KAAM,SACN,SAAU,EAAY,WAAa,KACnC,KAAM,EAAY,iBAAmB,UACrC,KAAM,SACN,MAAO,SAET,EAAE,8BAA+B,KAGrC,EACE,kBACA,CACE,SAAU,IAKR,GAJA,EAAE,iBACF,EAAkB,GAClB,EAAE,SAEE,IAAqB,GACvB,EAAkB,sCAClB,EAAkB,GAClB,OAGF,EAAc,GACd,EAAE,SACF,EAAE,QAAQ,CACR,OAAQ,OACR,IAAK,gBACL,KAAM,CACJ,SAAU,EACV,SAAU,KAGX,KAAK,IACJ,EAAkB,GAClB,EAAkB,EAAO,QACzB,EAAgB,EAChB,EAAgB,IAEjB,MAAM,IACL,EAAkB,EAAE,SAAS,QAC7B,EAAkB,KAEnB,QAAQ,KACP,EAAc,OAItB,CACE,EAAE,KAAM,YACR,EAAE,uDAAwD,CACxD,MAAO,EACP,QAAS,IACP,EAAmB,EAAE,OAAO,SAGhC,EACE,sEACA,CACE,MAAO,EACP,QAAS,IACP,EAAmB,EAAE,OAAO,SAIlC,EACE,6EACA,CACE,MAAO,EACP,QAAS,IACP,EAAkB,EAAE,OAAO,SAIjC,EAAE,EAAQ,CACR,KAAM,SACN,SAAU,EAAc,WAAa,KACrC,KAAM,EAAc,kBAAoB,YACxC,KAAM,YACN,MAAO,UAET,EACE,IACA,CACE,MACE,uBACC,GAAkB,UAAY,UAEnC,QASd,MAAe,ECzLT,EAAO,CACX,SAAU,IACR,SAAS,MAAQ,UAEnB,KAAM,GACG,EAAE,cAAe,CACtB,EAAE,IAAK,2DACP,EAAE,IAAK,sDAKE,ECTT,EAAQ,CACZ,KAAM,IACJ,MAAc,EAAM,MAAM,QACG,EAE7B,MAAO,GACL,qBACG,GAAM,SAAS,SAAW,EAAI,SAAW,cAC5C,CACE,EAAE,MAAO,CACP,EACE,EAAE,MAAM,KACR,CACE,KAAM,MAAM,EAAM,QAAQ,EAAM,KAChC,MAAO,GAAG,EAAM,UAAU,EAAM,QAElC,CAAC,EAAE,qBAAsB,CAAE,IAAK,EAAM,UAAW,IAAK,EAAM,WAGhE,EAAE,wBAAyB,CACzB,EAAM,SAAS,OAAS,EACpB,EACE,EAAE,MAAM,KACR,CACE,KAAM,MAAM,EAAM,QAAQ,EAAM,KAChC,MAAO,kCAET,OAAO,EAAM,SAAS,OAAS,aAEjC,GACJ,EAAM,SACH,MAAM,CAAC,GACP,IAAI,GACH,EAAE,EAAS,CAAE,KAAM,EAAM,KAAM,QAAS,EAAM,GAAI,mBAQhE,cACE,MAAa,KACG,GAEhB,MAAO,CACL,OAAQ,KACN,EAAY,GACZ,EAAK,QAAQ,CACX,OAAQ,MACR,IAAK,iBAEJ,KAAK,IACJ,EAAS,EAAK,SAEf,MAAM,IACL,QAAQ,IAAI,KAEb,QAAQ,KACP,EAAY,MAIlB,SAAU,IACR,SAAS,MAAQ,2BAGnB,KAAM,IACJ,MAAc,GAEd,MAAI,GACK,EAAE,cAAe,EAAE,IAGxB,EAAO,SAAW,EACb,EAAE,cAAe,CACtB,EAAE,IAAK,+DACP,EAAE,IAAK,CACL,6BACA,EAAE,EAAE,MAAM,KAAM,CAAE,KAAM,MAAQ,oBAChC,QAKC,EAAE,sBAAuB,CAC9B,EAAO,IAAI,GAAW,EAAE,EAAO,CAAE,eAMzC,MAAe,EC5FT,EAAS,CACb,OAAQ,IACN,SAAS,MAAQ,IAAI,EAAM,MAAM,wBACjC,EAAY,cAAc,EAAM,MAAM,QAExC,KAAM,GACG,EACL,cACA,EAAY,UACR,EAAE,GACF,OAAO,QAAQ,EAAY,QAAQ,IAAI,SACrC,EAAE,MAAO,CACP,EAAE,0BAA2B,GAC7B,EACI,EAAE,wBAAyB,CACzB,WACA,EAAE,SAAU,EAAO,QACnB,UAAU,EAAO,OAAS,EAAI,IAAM,UACpC,EAAY,QAEd,EACE,wBACA,mBAAmB,EAAY,UAErC,EACE,sBACA,EAAO,IAAI,GACT,EACE,EAAE,MAAM,KACR,CACE,MAAO,iBACP,KAAM,MAAM,KAAQ,EAAM,KAC1B,MAAO,EAAM,MAEf,CACE,EAAE,MAAO,CAAE,IAAK,EAAM,UAAW,IAAK,EAAM,OAC5C,EAAE,OAAQ,EAAS,EAAM,KAAM,gBAWtC,EC/Cf,WAAe,GACb,MAAgB,KACO,KACE,KACb,KAGZ,MAAO,CACL,OAAQ,IACN,SAAS,MAAQ,QACjB,EAAY,GACZ,EAAE,SAEF,EAAK,QAAQ,CACX,OAAQ,MACR,IAAK,4BACL,OAAQ,CACN,KAAM,EAAM,MAAM,KAClB,QAAS,EAAM,MAAM,WAGtB,KAAK,IACJ,EAAQ,EACR,SAAS,MAAQ,EAAM,OAExB,QAAQ,KACP,EAAY,MAGlB,KAAM,IACJ,GAAI,CAAC,GAAa,EAAK,cACrB,EAAa,GACb,YAAiB,GAAM,SACrB,GAAI,CAAC,EAAK,SACR,EAAa,GACb,OAIN,MAAO,GACL,cACA,EACI,EAAE,GACF,CACE,EAAE,KAAM,EAAM,MACd,EAAE,qBAAsB,CACtB,EAAK,aACD,CACE,EAAE,EAAQ,CACR,KAAM,WACN,SAAU,EAAmB,WAAa,KAC1C,KAAM,EACF,gBACA,EAAM,aACN,YACA,SACJ,MAAO,EAAM,aAAe,MAAQ,QACpC,MAAO,EAAM,aACT,oBACA,kBACJ,QAAS,IACP,EAAmB,GACnB,EAAE,SACF,EAAK,QAAQ,CACX,OAAQ,OACR,IAAK,cACL,KAAM,CACJ,KAAM,EAAM,KACZ,SAAU,EAAM,GAChB,OAAQ,CAAC,EAAM,gBAGhB,KAAK,IACJ,EAAM,aAAe,EAAK,SAE3B,QAAQ,KACP,EAAmB,QAI3B,EAAE,EAAQ,CACR,KAAM,eACN,SACE,GAAsB,EAAa,WAAa,KAClD,KAAM,EACF,gBACA,EACA,YACA,WACJ,MAAO,QACP,MAAO,EACH,KACA,qCACJ,QAAS,IACP,EAAqB,GACrB,EAAE,SACF,EAAK,QAAQ,CACX,OAAQ,OACR,IAAK,YACL,KAAM,CACJ,KAAM,EAAM,SACT,OAAO,GAAQ,CAAC,EAAG,SACnB,IAAI,GACI,EACL,KAAM,EAAM,KACZ,SAAU,EAAM,GAChB,WAAY,EAAG,SAKtB,KAAK,IACJ,EAAM,SAAS,QAAQ,IACrB,EAAK,QAAU,OAGlB,QAAQ,KACP,EAAqB,SAK/B,KACJ,EACE,2DACA,CAAE,KAAM,EAAM,YACd,CAAC,EAAM,KAAM,EAAE,kCAGnB,EAAE,8BAA+B,CAAE,IAAK,EAAM,QAC9C,EAAM,aAAa,IAAI,GAAU,EAAE,IAAK,IACxC,EAAM,SACF,EAAM,SAAS,IAAI,GACjB,EAAE,EAAS,CAAE,KAAM,EAAM,KAAM,QAAS,EAAM,GAAI,aAEpD,EAAE,IAAK,iCAOzB,MAAe,EC9IT,EAAqB,CACzB,KAAM,IAAM,EAAE,KAAM,CAAC,EAAE,gCAGE,CACzB,KAAM,IAAM,EAAE,KAAM,CAAC,EAAE,2BAGF,CACrB,KAAM,GACG,EAAE,EAAQ,CACf,KAAM,sBACN,MAAO,MACP,QAAS,IACP,IAAQ,QAAS,EAAM,MACvB,EAAK,OAAS,EAAU,QAKxB,EAAK,IAAM,EAAK,IAAI,SAAS,KACzB,EAAK,IAAI,MAAM,EAAG,IAClB,EAAK,IAAM,UAML,CAChB,QAAS,UACT,UAAW,YACX,OAAQ,UAGV,cACE,MACA,MAAO,CACL,OAAQ,IACN,EAAa,EAAM,MAAM,KAE3B,KAAM,GACG,EAAE,MAAO,CACd,IAAK,EACL,MAAO,EAAM,MAAM,MACnB,OAAQ,EAAM,MAAM,OACpB,QAAS,IACP,AAAI,IAAe,EAAM,MAAM,KAAO,EAAM,MAAM,SAAW,KAC3D,EAAa,EAAM,MAAM,OAEzB,EAAM,MAAM,QAAQ,OAQhC,cACE,MAAgB,KACF,KACI,KACC,SAGM,OACK,OACD,GAE7B,aACE,GAAI,EAAa,OAAS,GACxB,SAAoB,EAAa,OAAO,EAAG,GAAG,GAC9C,EAAY,KAAK,CACf,OAAQ,EAAU,QAClB,MACA,eAEG,AAAI,GAAQ,cAAgB,IAAuB,MAIxD,GAAqB,EAAa,IAAI,CACpC,OACA,UACA,UAAW,EAAQ,aAAa,KAC/B,KAAK,IACN,QAAQ,IAAI,2BAA4B,EAAgB,IACxD,AAAI,EAAY,UAAU,OAAS,EACjC,EAA0B,EAAY,MAAM,IAAI,OACvC,CAAC,EAAM,EAAY,UAAU,KAGtC,EAA0B,EAAY,MAAM,IAAI,GACvC,CAAC,EAAM,OAIlB,IACA,OAKN,aACE,GAAI,IAA4B,MAC1B,EAAwB,OAAS,GACnC,SAAsB,EAAwB,OAAO,EAAG,GAAG,GAC3D,EAAuB,KAAK,CAAE,MAAK,YAKzC,MAAO,CACL,OAAQ,IACN,SAAS,MAAQ,gBACjB,EAAO,EAAM,MAAM,KACnB,EAAU,EAAM,MAAM,QAEtB,EAAY,GACZ,EAAE,SAEF,EAAa,IAAI,CACf,KAAM,EAAM,MAAM,KAClB,QAAS,EAAM,MAAM,QACrB,UAAW,EAAM,MAAM,YAEtB,KAAK,IACJ,EAAU,EACV,SAAS,MAAQ,EAAgB,GAGjC,AAAI,EAAQ,UAAU,OAAS,EAC7B,EAAe,EAAQ,MAAM,IAAI,OACxB,CAAC,EAAM,EAAQ,UAAU,KAGlC,EAAe,EAAQ,MAAM,IAAI,GACxB,CAAC,EAAM,OAKlB,IACA,IACA,MAED,QAAQ,KACP,EAAY,MAGlB,KAAM,IACJ,GAAI,EACF,MAAO,GAAE,sBAAuB,EAAE,IAGpC,IAAQ,OAAM,WAAY,EAAM,QACnB,EAAQ,eACR,EAAQ,eACL,EAAE,uBAAwB,CACxC,EACI,EACE,EAAE,MAAM,KACR,CACE,MAAO,iBACP,KAAM,MAAM,KAAQ,KAAW,EAAK,MAEtC,CAAC,EAAE,6BAA8B,EAAE,OAAQ,UAE7C,EAAE,EAAQ,CACR,KAAM,OACN,KAAM,gBACN,SAAU,KAEhB,EACE,EAAE,MAAM,KACR,CACE,MAAO,iBACP,KAAM,MAAM,KAAQ,KAEtB,CAAC,EAAE,oBAAqB,EAAE,OAAQ,mBAEpC,EACE,EAAE,MAAM,KACR,CACE,MAAO,iBACP,KAAM,EACF,MAAM,KAAQ,KAAW,EAAK,KAC9B,MAAM,KAAQ,IAClB,QAAS,GACP,CAAI,EAAK,cACP,EAAK,QAAQ,CACX,OAAQ,OACR,IAAK,YACL,KAAM,CACJ,KAAM,CACJ,CACE,OACA,SAAU,EACV,WAAY,EAAQ,QAMvB,KAGX,CACE,EAAE,OAAQ,EAAO,OAAS,UAC1B,EAAE,eAAkB,GAAO,iBAAmB,qBAIpD,MAAO,GAAE,sBAAuB,CAC9B,EAAE,KAAM,EAAgB,IACxB,EACA,EACE,MACA,CACE,MACE,iBACC,GAAQ,WAAa,oBAAsB,KAEhD,CACE,EAAY,IAAI,OACd,EAAE,MAAO,CAAE,IAAK,EAAK,KAAO,CAC1B,EAAE,EAAiB,CACjB,IAAK,EAAK,IACV,OAAQ,EAAK,OACb,MAAO,CACL,QACE,EAAK,SAAW,EAAU,UAAY,QAAU,QAEpD,OAAQ,IACN,EAAK,OAAS,EAAU,UACxB,KAEF,QAAS,IACP,EAAK,OAAS,EAAU,OACxB,OAGJ,EAAK,SAAW,EAAU,QACtB,EAAE,GACF,KACJ,EAAK,SAAW,EAAU,OACtB,EACE,MACA,CAAE,MAAO,CAAE,gBAAiB,UAC5B,EAAE,EAAgB,CAAE,UAEtB,QAGR,EAAa,IAAI,IAAM,EAAE,MAG7B,EACA,EAAuB,IAAI,GACzB,EAAE,EAAiB,CACjB,MAAO,CAAE,QAAS,QAClB,OAAQ,EACR,QAAS,EACT,IAAK,EAAK,IACV,OAAQ,EAAK,cAQzB,MAAe,EC/Qf,WAAkB,GAChB,MAAoB,OACJ,OACE,GAElB,MAAO,CACL,OAAQ,IACN,SAAS,MAAQ,yBAEnB,KAAM,GACG,EAAE,cAAe,CACtB,EAAE,KAAM,4BACR,EACE,oCACA,CACE,SAAU,IACR,EAAG,iBAEH,MAAa,SAAS,eAAe,aAAa,MAAM,KAC3C,GAAI,UACjB,EAAK,OAAO,YAAa,GAEzB,EAAc,GACd,EAAgB,KAChB,EAAE,SACF,EAAK,QAAQ,CACX,OAAQ,OACR,IAAK,cACL,SAEC,KAAK,IACJ,EAAgB,EAAK,QACrB,EAAY,KAEb,MAAM,IACL,EAAgB,EAAI,SAAS,QAC7B,EAAY,KAEb,QAAQ,KACP,EAAc,OAItB,CACE,EAAE,IAAK,CACL,SACA,EAAE,IAAK,qCACP,gDAEF,EAAE,uDACF,EAAE,MACF,EAAE,EAAQ,CACR,KAAM,SACN,KAAM,EAAc,eAAiB,SACrC,MAAO,QACP,KAAM,SACN,SAAU,EAAc,WAAa,SAI3C,EACE,IACA,CAAE,MAAO,aAAa,EAAY,UAAY,aAC9C,GAEF,EACI,EAAE,EAAE,MAAM,KAAM,CAAE,KAAM,MAAQ,iCAChC,QAMZ,MAAe,EClEf,EAAK,OAAO,KAAK,KACf,IAAM,EAAO,SAAS,eAAe,YACrC,EAAE,MAAM,OAAS,GACjB,EAAE,MAAM,EAAM,IAAK,CACjB,IAAK,CACH,QAAS,KACP,GAAI,EAAK,aACP,EAAE,MAAM,IAAI,KAAM,KAAM,CAAE,QAAS,SAEnC,OAAO,IAGX,OAAQ,GAAW,EAAE,EAAQ,IAE/B,KAAM,CACJ,QAAS,KACP,GAAI,EAAK,aACP,EAAE,MAAM,IAAI,KAAM,KAAM,CAAE,QAAS,SAEnC,OAAO,IAGX,OAAQ,GAAW,EAAE,EAAQ,IAE/B,KAAM,CACJ,QAAS,KACP,GAAI,EAAK,aACP,MAAO,GAEP,EAAE,MAAM,IAAI,KAAM,KAAM,CAAE,QAAS,MAGvC,OAAQ,GAAW,EAAE,EAAQ,IAE/B,YAAa,CACX,OAAQ,GACN,EACE,EACA,EAAE,EAAQ,CACR,MAAO,EAAM,MAAM,MACnB,IAAK,EAAM,MAAM,UAOzB,oBAAqB,CACnB,OAAQ,GACN,EACE,EACA,EAAE,EAAO,CACP,KAAM,EAAM,MAAM,KAClB,QAAS,EAAM,MAAM,YAI7B,+BAAgC,CAC9B,OAAQ,GACN,EACE,EACA,EAAE,EAAS,CACT,KAAM,EAAM,MAAM,KAClB,QAAS,EAAM,MAAM,QACrB,UAAW,EAAM,MAAM,UACvB,IAAK,EAAM,MAAM,cAIzB,KAAM,CACJ,QAAS,KACP,GAAI,EAAK,aACP,MAAO,GAEP,EAAE,MAAM,IAAI,KAAM,KAAM,CAAE,QAAS,MAGvC,OAAQ,GAAW,EAAE,EAAQ",
  "names": []
}
