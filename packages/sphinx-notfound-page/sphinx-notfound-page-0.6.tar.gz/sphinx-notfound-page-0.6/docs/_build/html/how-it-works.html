<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>How It Works &mdash; sphinx-notfound-page 0.4 documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono"><link rel="stylesheet" href="_static/typlog.css?v=0.7.3" type="text/css" />
  <link rel="stylesheet" href="_static/theme.css?v=0.7.3" type="text/css" /><link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="index" title="Index" href="genindex.html"/>
      <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="sphinx-notfound-page 0.4 documentation" href="index.html"/>
      <link rel="next" title="Get Involved" href="get-involved.html"/>
      <link rel="prev" title="Configuration" href="configuration.html"/>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', '');ga('send', 'pageview');</script>
  <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="sphinx-notfound-page">
  <meta property="og:title" content="How It Works">
  <meta name="twitter:card" content="summary">
</head>
<body role="document" data-page="how-it-works">
  <header class="t-head">
    <div class="t-head_menu"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M64 384h384v-42.666H64V384zm0-106.666h384v-42.667H64v42.667zM64 128v42.665h384V128H64z"/></svg></div>
    <a class="t-head_logo" href="index.html">sphinx-notfound-page
    </a>
  </header>
  <aside class="t-sidebar">
    <div class="t-sidebar_close">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M405 136.798L375.202 107 256 226.202 136.798 107 107 136.798 226.202 256 107 375.202 136.798 405 256 285.798 375.202 405 405 375.202 285.798 256z"/></svg>
    </div>
    <div class="inner">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How It Works</a><ul>
<li><a class="reference internal" href="#events-subscribed">Events subscribed</a><ul>
<li><a class="reference internal" href="#doctree-resolved">doctree-resolved</a></li>
<li><a class="reference internal" href="#html-collect-pages">html-collect-pages</a></li>
<li><a class="reference internal" href="#html-page-context">html-page-context</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="configuration.html" title="previous chapter">Configuration</a></li>
      <li>Next: <a href="get-involved.html" title="next chapter">Get Involved</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/how-it-works.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox">
  <form class="search" action="search.html" method="get">
    <div class="input-group">
      <input type="text" name="q" placeholder="Search" />
      <button type="submit">Go</button>
    </div>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    </div>
  </aside>
  <div class="t-content">
    <div class="t-body yue">
      
  <div class="section" id="how-it-works">
<h1>How It Works<a class="headerlink" href="#how-it-works" title="Permalink to this headline">¶</a></h1>
<p>The extension subscribes to some events emitted by the Sphinx application.
When these events are triggered,
our functions are called and they manipulate the doctree and context passed to the template.</p>
<div class="section" id="events-subscribed">
<h2>Events subscribed<a class="headerlink" href="#events-subscribed" title="Permalink to this headline">¶</a></h2>
<p>There are 3 main events that this extension subscribes:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">doctree-resolved</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">html-collect-pages</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">html-page-context</span></code></li>
</ul>
<p>Each one has an specific goal persuading the same objective:
make all resources URLs absolutes.</p>
<div class="section" id="doctree-resolved">
<h3>doctree-resolved<a class="headerlink" href="#doctree-resolved" title="Permalink to this headline">¶</a></h3>
<p>After Sphinx has parsed our source files, this event is triggered.
Here, we check if the page being rendered is <code class="docutils literal notranslate"><span class="pre">notfound_pagename</span></code> and in that case,
we replace all the URLs for <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">image::</span></code>, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">figure::</span></code> and other directives to point the right path.</p>
</div>
<div class="section" id="html-collect-pages">
<h3>html-collect-pages<a class="headerlink" href="#html-collect-pages" title="Permalink to this headline">¶</a></h3>
<p>After all HTML pages are collected and this event is emitted,
we check for the existence of a <code class="docutils literal notranslate"><span class="pre">404</span></code> page already.
If there is one, we do not need to do anything here.
If the user has not defined this page,
we render the template <code class="docutils literal notranslate"><span class="pre">notfound_template</span></code> with the context <code class="docutils literal notranslate"><span class="pre">notfound_context</span></code>.</p>
</div>
<div class="section" id="html-page-context">
<h3>html-page-context<a class="headerlink" href="#html-page-context" title="Permalink to this headline">¶</a></h3>
<p>Immediately before the template is rendered with the context, this event is emitted.
At this point, we override <code class="docutils literal notranslate"><span class="pre">pathto</span></code> <a class="footnote-reference" href="#pathto" id="id1">[1]</a> function with our custom one that will generate the proper URLs.
We also override <code class="docutils literal notranslate"><span class="pre">toctree</span></code> <a class="footnote-reference" href="#toctree" id="id2">[2]</a> key with the same content of the regular toctree but with all the URLs fixed to find the resources from the 404 page.</p>
<table class="docutils footnote" frame="void" id="pathto" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="https://www.sphinx-doc.org/page/templating.html#pathto">https://www.sphinx-doc.org/page/templating.html#pathto</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="toctree" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><a class="reference external" href="https://www.sphinx-doc.org/page/templating.html#toctree">https://www.sphinx-doc.org/page/templating.html#toctree</a></td></tr>
</tbody>
</table>
</div>
</div>
</div>

  <div class="t-pagination clearfix">
    <span>
      ← <a href="configuration.html" title="Configuration">Configuration</a>
    </span>
    <span style="float:right">
      <a href="get-involved.html" title="Get Involved">Get Involved</a> →
    </span>
  </div>

    </div><footer class="t-foot">
    &copy; Copyright 2019, Manuel Kaufmann.
    <br>
    A <a href="https://typlog.com/">typlog</a> <a href="https://github.com/typlog/sphinx-typlog-theme">sphinx theme</a>,
    designed by <a href="https://lepture.com/">Hsiaoming Yang</a>.
</footer>
  </div>
  <script>$(function(){$(".t-head_menu").on("click",function(){$("body").addClass("_expand")});$(".t-body").on("click",function(){$("body").removeClass("_expand")});$(".t-sidebar_close").on("click",function(){$("body").removeClass("_expand")});$("a.footnote-reference").on("click",function(e){e.preventDefault();var id=$(this).attr("href");var html=$(id).find("td.label + td").html();var w=Math.max(document.documentElement.clientWidth,window.innerWidth||0);var style="top:"+e.pageY+"px;";if(w>560){style+="width:480px;";if(e.pageX>240&&e.pageX+240<w){style+="left:"+(e.pageX-240)+"px;"}else if(e.pageX<=240){style+="left:20px;"}else{style+="right:20px;"}}showFootnote(html,style)});function showFootnote(html,style){var CONTENT_ID="typlog-footnote-content";var content=document.getElementById(CONTENT_ID);if(!content){content=document.createElement("div");content.id=CONTENT_ID;$(".t-body").append(content)}var MASK_ID="typlog-footnote-mask";var mask=document.getElementById(MASK_ID);if(!mask){mask=document.createElement("div");mask.id=MASK_ID;document.body.appendChild(mask);mask.addEventListener("click",function(){content.className="";mask.className=""})}content.innerHTML=html;content.setAttribute("style",style);content.className="_active";mask.className="_active"}function fetchGitHubRepo(repo){var url="https://api.github.com/repos/"+repo;$.getJSON(url,function(data){var counts=[+new Date,data.stargazers_count,data.forks_count];localStorage.setItem("gh:"+repo,JSON.stringify(counts));updateGitHubStats(counts[1],counts[2])})}function updateGitHubStats(stars,forks){$(".github_stars strong").text(stars);$(".github_forks strong").text(forks)}function initGitHub(url){if(!url){return}var repo=url.replace("https://github.com/","");var cache=localStorage.getItem("gh:"+repo);if(cache){try{var counts=JSON.parse(cache);updateGitHubStats(counts[1],counts[2]);var delta=new Date-counts[0];if(delta<0||delta>9e5){fetchGitHubRepo(repo)}}catch(error){fetchGitHubRepo(repo)}}else{fetchGitHubRepo(repo)}}initGitHub($(".github").attr("href"))});</script>
</body>
</html>