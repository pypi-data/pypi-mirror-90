[tox]
# Having the .tox directory in the project directory slows down the
# `pip install -e .` step required by `usedevelop = true` considerably.
# By moving it out of the way (~500MB), we trim test execution time by > 80%.
skipsdist = true
# skip_missing_interpreters = true
toxworkdir = {homedir}/.toxenvs/pip-reqs
envlist =
    test-py{36,37,38,39,27}-pip{19.0.3,19.1.1,19.2.3,19.3.1,20.0.2,20.1.1,20.2,20.3,20.3.3},
    lint,
    coverage

[testenv]
setenv =
    COVERAGE_FILE = .artifacts/coverage.{env:TOX_ENV_NAME}
deps =
    test: pytest
    test: pytest-cov
    test: mock
    lint: flake8
    coverage: coverage
    pip19.0: pip==19.0
    pip19.0.1: pip==19.0.1
    pip19.0.2: pip==19.0.2
    pip19.0.3: pip==19.0.3
    pip19.1: pip==19.1
    pip19.1.1: pip==19.1.1
    pip19.2: pip==19.2
    pip19.2.1: pip==19.2.1
    pip19.2.2: pip==19.2.2
    pip19.2.3: pip==19.2.3
    pip19.3: pip==19.3
    pip19.3.1: pip==19.3.1
    pip20.0.1: pip==20.0.1
    pip20.0.2: pip==20.0.2
    pip20.1.1: pip==20.1.1
    pip20.2: pip==20.2
    pip20.3: pip==20.3
    pip20.3.3: pip==20.3.3
commands =
    test: py.test -rxs --cov-report= --cov pip_reqs --pyargs {posargs:pip_reqs}
    lint: flake8 pip_reqs

[testenv:coverage]
setenv =
    COVERAGE_FILE = .artifacts/coverage
commands =
    coverage combine .artifacts/
    coverage html
    coverage report

[flake8]

[pytest]
filterwarnings =
    ignore:the imp module is deprecated.*:DeprecationWarning
