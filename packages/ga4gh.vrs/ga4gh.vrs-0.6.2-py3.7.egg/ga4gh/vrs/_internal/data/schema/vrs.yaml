# VRS uses yaml as the source document for json schema
#
# To convert vrs.yaml to vrs.json:
#   make vrs.json
# You'll probably have to `pip install pyyaml` first.
#
# To watch for changes and update automatically:
#   make watch &

# https://json-schema.org/understanding-json-schema/reference/schema.html
$schema: "http://json-schema.org/draft-04/schema"
title: "GA4GH-VRS-Definitions"
type: object

definitions:
  # VRS definitions are presented top-down.  Everything rolls up to
  # Variation, which is a polymorphic abstraction of many kinds of
  # variation.


  ############################################################################
  # Locations

  Location:
    additionalProperties: false
    description: >-
      A Location represents a span on a specific sequence.
    oneOf:
      - $ref: "#/definitions/ChromosomeLocation"
      - $ref: "#/definitions/SequenceLocation"
      - $ref: "#/definitions/TranscriptLocation"
      - $ref: "#/definitions/GeneLocation"
    discriminator:
      propertyName: type

  ChromosomeLocation:
    description: >-
      A region of a chromosomed specified by species and name using
      cytogenetic naming conventions
    type: object
    properties:
      type:
        type: string
        enum: [ChromosomeLocation]
        default: ChromosomeLocation
      _id:
        $ref: "#/definitions/CURIE"
      species_id:
        $ref: "#/definitions/CURIE"
        default: "taxonomy:9606"
      chr:
        type: string
      interval:
        $ref: "#/definitions/CytobandInterval"
    additionalProperties: false
    required:
      - type
      - species_id
      - chr
      - interval

  SequenceLocation:
    additionalProperties: false
    description: >-
      A specified subsequence within another sequence that is used as a reference sequence.
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [SequenceLocation]
        default: SequenceLocation
      sequence_id:
        $ref: "#/definitions/CURIE"
      interval:
        $ref: "#/definitions/SequenceInterval"


  ############################################################################
  # SequenceInterval
  # * SimpleInterval

  SequenceInterval:
    additionalProperties: false
    oneOf:
      - $ref: '#/definitions/SimpleInterval'
      - $ref: '#/definitions/NestedInterval'
    discriminator:
      propertyName: type

  SimpleInterval:
    description: >-
      A SimpleInterval represents a span of sequence. Positions are
      always represented by contiguous spans using interbase
      coordinates.

      This definition of SequenceInterval is intended to be compatible with that
      in Sequence Ontology
      ([SO:0000001](http://www.sequenceontology.org/browser/current_svn/term/SO:0000001)),
      with the exception that the GA4GH VRS SequenceInterval may be
      zero-width. The SO definition is for an "extent greater than
      zero".
    additionalProperties: false
    type: object
    properties:
      type:
        type: string
        enum: [SimpleInterval]
        default: SimpleInterval
      start:
        type: ["integer", "null"]
        default: null
      end:
        type: ["integer", "null"]
        default: null
    required:
      - start
      - end
    example:
      type: SimpleInterval
      start: 11
      end: 22

  NestedInterval:
    type: object
    additionalProperties: false
    properties:
      type:
        type: string
        enum: [NestedInterval]
        default: NestedInterval
      inner:
        $ref: '#/definitions/SimpleInterval'
      outer:
        $ref: '#/definitions/SimpleInterval'
    example:
      type: NestedInterval
      inner:
        type: SimpleInterval
        start: 20
        end: 30
      outer:
        type: SimpleInterval
        start: 10
        end: 40

  CytobandInterval:
    description: >-
      A contiguous region specified by chromosomal bands features.
    type: object
    additionalProperties: false
    properties:
      type:
        type: string
        enum: [CytobandInterval]
        default: CytobandInterval
      start:
        $ref: "#/definitions/Cytoband"
      end:
        $ref: "#/definitions/Cytoband"
    required:
      - start
      - end
    example:
      type: CytobandInterval
      start: q22.2
      end: q22.3

  ############################################################################
  # Variation

  Variation:
    additionalProperties: false
    description: >-
      The root class of all Variation types
    oneOf:
      - $ref: "#/definitions/Allele"
      - $ref: "#/definitions/Haplotype"
      - $ref: "#/definitions/Text"
      - $ref: "#/definitions/VariationSet"
      - $ref: "#/definitions/Abundance"
    discriminator:
      propertyName: type

  Abundance:
    additionalProperties: false
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [Abundance]
        default: Abundance
      location:
        $ref: "#/definitions/Location"
      amount:
        # TODO: Structure each of the options below
        description: >-
          Systemic quantity. Intended options: 1) absolute copy min
          (>=0) and max; 2) relative copy number quantity min (>=1)
          and max. Relative must also note; 3) qualitative relative
          copy number: gt, ge, lt, le, eq
        oneOf:
          - type: object
            additionalProperties: false
            properties:
              measure:
                type: string
                enum: ["AbsoluteCounts"]
                default: "AbsoluteCounts"
              min:
                type: integer
              max:
                type: integer
            required:
              - measure
              - min
              - max
          - type: object
            additionalProperties: false
            properties:
              measure:
                type: string
                enum: ["RelativeCounts"]
                default: "RelativeCounts"
              min:
                type: integer
              max:
                type: integer
            required:
              - measure
              - min
              - max
          - type: object
            additionalProperties: false
            properties:
              measure:
                type: string
                enum: ["Qualitative"]
                default: "Qualitative"
              rel:
                type: string
                enum: ["gt", "ge", "eq", "le", "lt"]
            required:
              - measure
              - rel
    required:
      - type
      - location
      - amount

  Text:
    description: >-
      A textual description of variation, typically not parseable but
      understood by humans.
    additionalProperties: false
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [Text]
        default: Text
      definition:
        type: string
        description: >-
          An textual representation of variation intended to capture
          variation descriptions that cannot be parsed, but still
          treated as variation.

  Allele:
    description: >-
      An assertion of a sequence state at a Location.
    additionalProperties: false
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [Allele]
        default: Allele
      location:
        oneOf:
          - $ref: "#/definitions/CURIE"
          - $ref: "#/definitions/Location"
      state:
        $ref: "#/definitions/State"


  VariationSet:
    description: >-
      A set of Variation objects.

      Members may be specified inline or by reference (with CURIEs)
    type: "object"
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: ["VariationSet"]
        default: "VariationSet"
      members:
        type: array
        uniqueItems: true
        items:
          oneOf:
            - $ref: "#/definitions/Variation"
            - $ref: "#/definitions/CURIE"


  Haplotype:
    description: >-
      A set of zero or more Alleles
    additionalProperties: false
    type: "object"
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: ["Haplotype"]
        default: "Haplotype"
      members:
        type: array
        minItems: 1
        uniqueItems: true
        items:
          oneOf:
            - $ref: "#/definitions/Allele"
            - $ref: "#/definitions/CURIE"


  ############################################################################
  # States

  State:
    oneOf:
      - $ref: "#/definitions/SequenceState"
      - $ref: "#/definitions/RepeatState"

  SequenceState:
    description: >-
      An assertion of the state of a sequence, typically at a Sequence
      Location within an Allele
    additionalProperties: false
    type: object
    properties:
      type:
        type: string
        enum: [SequenceState]
        default: SequenceState
      sequence:
        type: string
        nullable: false
    required:
      - type
      - sequence
    example:
      type: SequenceState
      sequence: C



  ############################################################################
  # Basic types
  # These types are used solely within other definitions.

  DateTime:
    additionalProperties: false
    type: string
    format: "date-time"

  CURIE:
    additionalProperties: false
    description: >-
      A string that refers to an object uniquely.  The lifetime and
      scope of an id is defined by the sender.

      VRS does not impose any contraints on strings used as ids in
      messages. However, to maximize sharability of data, VRS
      RECOMMENDS that implementations use [W3C Compact URI
      (CURIE)](https://www.w3.org/TR/curie/) syntax.

      String CURIEs are represented as `prefix`:`reference` (W3C
      terminology), but often referred to as `namespace`:`accession`
      or `namespace`:`local id` colloquially.

      VRS also RECOMMENDS that `prefix` be defined in identifiers.org.

      The `reference` component is an unconstrained string.

      A CURIE is a URI.  URIs may *locate* objects (i.e., specify
      where to retrieve them) or *name* objects conceptually.  VRS uses
      CURIEs primarily as a naming mechanism.

      Implementations MAY provide CURIE resolution mechanisms for
      prefixes to make these objects locatable.

      Using internal ids in public messages is strongly discouraged.

    type: string
    pattern: '^\w[^:]*:.+$'
    example: "ensembl:ENSG00000139618"


  Cytoband:
    description: >-
      A feature referencing a giesma-stained band on an unspecified human chromosome.
    type: string
    pattern: '^[pq][1-9][0-9]*(\.[1-9][0-9]*)?$'
    example: "q22.3"


  Transcript:
    description: >-
      A specified subsequence within another sequence that is used as a reference sequence.
    type: object
    additionalProperties: false
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [Transcript]
        default: Transcript
      sequence_id:
        $ref: "#/definitions/CURIE"
      exons:
        type: array
        items:
          $ref: "#/definitions/SimpleInterval"
      cds:
        $ref: "#/definitions/SimpleInterval"

  TranscriptLocation:
    additionalProperties: false
    description: >-
      A specified subsequence within another sequence that is used as a reference sequence.
    type: object
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [TranscriptLocation]
        default: TranscriptLocation
      transcript:
        oneOf:
          - $ref: "#/definitions/CURIE"
          - $ref: "#/definitions/Transcript"
      interval:
        oneOf:
          - $ref: '#/definitions/SimpleInterval'
          - $ref: '#/definitions/BaseOffsetInterval'
          - $ref: '#/definitions/TranscriptFeatureInterval'

  BaseOffsetInterval:
    additionalProperties: false
    type: object
    properties:
      type:
        type: string
        enum: [BaseOffsetInterval]
        default: BaseOffsetInterval
      datum:
        type: string
        enum: ["seqstart", "cdsstart"]
      start:
        $ref: "#/definitions/BaseOffset"
      end:
        $ref: "#/definitions/BaseOffset"

  BaseOffset:
    type: object
    additionalProperties: false
    properties:
      base:
        type: integer
      offset:
        type: integer
        default: 0

  TranscriptFeatureInterval:
    additionalProperties: false
    type: object
    properties:
      type:
        type: string
        enum: [TranscriptFeatureInterval]
        default: TranscriptFeatureInterval
      start:
        $ref: "#/definitions/TranscriptFeature"
      end:
        $ref: "#/definitions/TranscriptFeature"

  TranscriptFeature:
    type: object
    additionalProperties: false
    properties:
      feature_type:
        type: string
        enum: ["5'utr", "3'utr", "exon", "intron"]
      index:
        type: integer
      

  # ============================================================================
  # GeneLocation

  GeneLocation:
    description: >-
      A reference to an external gene system, used as a location for
      variation.  Currently, the `ncbigene` namespace is required. See
      https://registry.identifiers.org/registry/ncbigene.
    type: object
    additionalProperties: false
    properties:
      _id:
        $ref: "#/definitions/CURIE"
      type:
        type: string
        enum: [GeneLocation]
        default: GeneLocation
      gene_id:
        $ref: "#/definitions/CURIE"
        pattern: '^ncbigene:.+$'

  GeneLocation2:
    type: string
    pattern: '^ncbigene:.+$'


  # ============================================================================
  # Repeats

  RepeatState:
    description: >-
      A tandem repeat of a SequenceLocation
    additionalProperties: false
    type: object
    properties:
      type:
        type: string
        enum: [RepeatState]
        default: RepeatState
      sequence:
        oneOf:
          - type: string
          - $ref: "#/definitions/SequenceLocation"
          - $ref: "#/definitions/RegularExpression"
          - $ref: "#/definitions/SizedSequence"
      copies:
        type: object
        additionalProperties: false
        properties:
          min:
            type: integer
            minimum: 1
          max:
            type: ["integer", "null"]
    required:
      - type
      - copies
    example:
      type: SequenceState
      copies:
        min: 40
        max: 60
        
  RegularExpression:
    type: object
    additionalProperties: false
    properties:
      regexp:
        type:
          string
    required: ["regexp"]

  SizedSequence:
    type: object
    additionalProperties: false
    properties:
      min:
        type: integer
      max:
        type: ["integer", "null"]
        default: null
      modulus:
        type: integer
        default: 1
