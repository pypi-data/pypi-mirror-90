%path = "physics/mechanics/forces"
%kind = chindnum["examples"]
%level = 10 #in school years
<!-- html --><div class="section" id="structure-analysis-problem-solved-with-python">
<h1>Structure Analysis Problem solved with Python<a class="headerlink" href="#structure-analysis-problem-solved-with-python" title="Permalink to this headline">¶</a></h1>
<p>This pin jointed truss is the initial example taken from <a class="reference external" href="http://akabaila.pcug.org.au/StructuralAnalysis.pdf">akabaila</a></p>
<div class="figure">
<p><img src="_images/tikz-0e67550a51cb5cc3f5235164f6ee94e1a2e15b10.png" alt="\coordinate (A) at (0,0) (A) node [below]{0};
\coordinate (B) at (0,3) (B) node [above]{1};
\coordinate (C) at (4,0) (C) node [below]{2};
\coordinate (D) at (4,3) (D) node [above]{3};
\coordinate (E) at (8,0) (E) node [below]{4};
\coordinate (F) at (8,3) (F) node [above]{5};
\coordinate (G) at (12,0) (G) node [below]{6};
\coordinate (H) at (12,3) (H) node [above]{7};
\tikzset{-};
\draw[black,very thick] (A) -- (B) node [midway,left]{0};
\draw[black,very thick] (A) -- (C) node [midway,below]{3};
\draw[black,very thick] (B) -- (C) node [midway,left,below]{2};
\draw[black,very thick] (B) -- (D) node [midway,below]{1};
\draw[black,very thick] (C) -- (D) node [midway,left]{4};
\draw[black,very thick] (C) -- (E) node [midway,below]{7};
\draw[black,very thick] (D) -- (E) node [midway,left,below]{6};
\draw[black,very thick] (D) -- (F) node [midway,below]{5};
\draw[black,very thick] (E) -- (F) node [midway,left]{8};
\draw[black,very thick] (E) -- (G) node [midway,below]{10};
\draw[black,very thick] (E) -- (H) node [midway,right,below]{11};
\draw[black,very thick] (F) -- (H) node [midway,below]{9};
\draw[black,very thick]  (G) -- (H) node [midway,right]{12};
\draw[black,thin]  (0,0) -- (1,-1) -- (-1,-1) -- (0,0);
\draw[black,thin]  (12,0) -- (13,-1) -- (11,-1) -- (12,0);
\tikzset{-&gt;};
\draw[black,thin]  (4,-1) -- (4,-2) node [midway,right]{100kN};
\draw[black,thin]  (8,-1) -- (8,-2) node [midway,right]{150kN};
\tikzset{&lt;-&gt;};
\draw[black,very thin]  (0,4) -- (12,4) node [midway,above]{3x8m};
\draw[black,very thin]  (13,0) -- (13,3) node [midway,right]{6m};" /></p>
</div><p>It can be analysed using force and moment vectors,
because resulting linear equations are neither underdetermined
nor overdetermined, but determined.
The truss is said to be <em>statically determinate</em>.</p>
<p><strong>We want to find the forces along the members.</strong></p>
<p>To find all the forces along the members we use:</p>
<ul class="simple">
<li><p>no revolution: all moments must be matched by reacting moments</p></li>
<li><p>no translation: all forces in all nodes add to zero.</p></li>
</ul>
<p>We will solve this here using <code class="docutils literal notranslate"><span class="pre">Python</span></code> with <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy</span></code>
and more precisely we will do with these functions:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">dot</span><span class="p">,</span> <span class="n">cross</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">allclose</span><span class="p">,</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">finfo</span><span class="p">,</span> <span class="n">double</span><span class="p">;</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">norm</span><span class="p">,</span> <span class="n">solve</span><span class="p">;</span>
<span class="n">unit</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">R90</span> <span class="o">=</span> <span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span> <span class="c1"># rotate 90 degrees</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">array</span>
<span class="n">eps</span> <span class="o">=</span> <span class="n">finfo</span><span class="p">(</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
</pre></div>
</td></tr></table></div>
<p>First we need to describe the problem world, i.e. we need to find the variables.
By variable I mean the real thing here. A variable consists of values.
When using a value of a variable, then we do this via reference,
more precisely via index into the list of values representing the variable.</p>
<p>The following describes the system. I use capital letters for variables and
small letters for references to values of the variables. The names are short,
one letter if possible. I take the first letter of the english word. N is Nodes,
E is Edges, F is Forces, S is Support nodes. n, e, f and s reference values of these
variables. A value of Nodes consists of x and y, which reference the external variables
X and Y (the values of). By external I mean that they are not specified in the code.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#nodes = x, y</span>
<span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="n">V</span><span class="p">((</span><span class="n">a</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span><span class="n">b</span><span class="o">*</span><span class="mi">6</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)]];</span>
<span class="c1">#edge = (n1,n2), n_i = indix into N</span>
<span class="n">E</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">)]</span>
<span class="c1">#external forces = index into N for node of application, vector</span>
<span class="n">F</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">2</span><span class="p">,</span><span class="n">V</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">))),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">V</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">150</span><span class="p">)))]</span>
<span class="c1">#support points = indices into N</span>
<span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">];</span>
</pre></div>
</td></tr></table></div>
<p>Now let’s find the forces along the edges.</p>
<ol class="arabic">
<li><p>No revolution.</p>
<p>We need to make the moment created around one support point zero by constructing a force
at the other support point. If there were more than one other support point for an axis,
the system would be overdetermined, which we don’t handle here.</p>
</li>
</ol>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">react_to_mp_at_q</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;p != q are any nodes.</span>
<span class="sd">    m stands for moment. mp is the moment around node p.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dp</span><span class="o">=</span><span class="n">N</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">-</span><span class="n">N</span><span class="p">[</span><span class="n">mp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">norm_dp</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">norm_dp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">V</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ndp</span> <span class="o">=</span> <span class="n">dp</span><span class="o">/</span><span class="n">norm_dp</span>
    <span class="n">fq</span> <span class="o">=</span> <span class="n">mp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dot</span><span class="p">(</span><span class="n">R90</span><span class="p">,</span><span class="n">ndp</span><span class="p">)</span><span class="o">/</span><span class="n">norm_dp</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">fq</span>
</pre></div>
</td></tr></table></div>
<ol class="arabic" start="2">
<li><p>No translation</p>
<p>We distribute the forces to a node to those edges not having a
force associated yet.  In our 2D case we need two such edges. One is OK, if the
force is exactly in that direction.</p>
<p>The force placed on an edge via this distribution will be forwarded to the
other node, but there the direction must be changed: An edge under tension will
pull from both nodes and a contracted edge will push into both nodes.</p>
</li>
</ol>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">distribute</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">es</span><span class="p">,</span><span class="n">q</span><span class="p">):</span><span class="c1">#f = sum of forces on edges es to node q</span>
    <span class="n">ies</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">))</span> <span class="k">if</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">E</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">eo</span> <span class="o">=</span> <span class="p">[]</span><span class="c1">#edge, other node</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ies</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">es</span><span class="p">:</span>
            <span class="c1">#E[e]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">tt</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">E</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">if</span> <span class="n">tt</span><span class="o">==</span><span class="n">q</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="c1">#this</span>
            <span class="n">o</span> <span class="o">=</span> <span class="p">[</span><span class="n">tt</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">E</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">if</span> <span class="n">tt</span><span class="o">!=</span><span class="n">q</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="c1">#other</span>
            <span class="n">d0</span> <span class="o">=</span> <span class="n">unit</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="o">-</span><span class="n">N</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="n">mat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span>
            <span class="n">eo</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="p">,</span><span class="n">o</span><span class="p">))</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">transpose</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">mat</span><span class="p">))</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eo</span><span class="p">)</span><span class="o">==</span><span class="n">dim</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
            <span class="n">ff</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">yield</span> <span class="n">ff</span><span class="p">,</span> <span class="n">eo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="c1">#even if ff==0</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">eo</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">dim</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mat</span><span class="p">):</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">f</span><span class="p">)</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="n">norm</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">eps</span><span class="p">:</span> <span class="c1">#same direction</span>
                <span class="k">yield</span> <span class="n">f</span><span class="p">,</span><span class="n">eo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;node </span><span class="si">%i</span><span class="s1"> overdetermined&#39;</span><span class="o">%</span><span class="n">q</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">allclose</span><span class="p">(</span><span class="n">unit</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">yield</span> <span class="n">f</span><span class="p">,</span> <span class="n">eo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;node </span><span class="si">%i</span><span class="s1"> underdetermined&#39;</span><span class="o">%</span><span class="n">q</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The above <code class="docutils literal notranslate"><span class="pre">distribute</span></code> needs the edges along which forces come into the node.
We keep track of the edges with forces in a <code class="docutils literal notranslate"><span class="pre">{node,</span> <span class="pre">[(edge,force)..]}</span></code> dictionary.
Initially this is empty.  We add the external forces and the forces due to the moments.
Then we distribute forces in unbalanced nodes.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">no_revolution</span><span class="p">():</span>
    <span class="n">EF</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">p</span><span class="p">,[])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">))])</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">ff</span> <span class="ow">in</span> <span class="n">F</span><span class="p">:</span>
        <span class="n">EF</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(([],</span><span class="n">ff</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">!=</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">mp</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="nb">sum</span><span class="p">([</span><span class="n">cross</span><span class="p">(</span><span class="n">ff</span><span class="p">[</span><span class="mi">1</span><span class="p">],(</span><span class="n">N</span><span class="p">[</span><span class="n">ff</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">-</span><span class="n">N</span><span class="p">[</span><span class="n">p</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ff</span> <span class="ow">in</span> <span class="n">F</span><span class="p">]))</span>
                <span class="n">fq</span> <span class="o">=</span> <span class="n">react_to_mp_at_q</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
                <span class="n">EF</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(([],</span><span class="n">fq</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">EF</span>

<span class="k">def</span> <span class="nf">no_translation</span><span class="p">(</span><span class="n">EF</span><span class="p">):</span>
    <span class="n">_sum</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">tt</span><span class="p">:</span> <span class="p">[</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">tt</span><span class="p">)]</span>
    <span class="n">unbalanced</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:[(</span><span class="n">i</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">_sum</span><span class="p">(</span><span class="n">EF</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">EF</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allclose</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">0</span><span class="p">)]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">unbalanced</span><span class="p">()</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">q</span><span class="p">,(</span><span class="n">es</span><span class="p">,</span><span class="n">f</span><span class="p">)</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dist</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">distribute</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">es</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ff</span><span class="p">,</span><span class="n">eo</span> <span class="ow">in</span> <span class="n">dist</span><span class="p">:</span>
            <span class="n">EF</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(([</span><span class="n">eo</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="o">-</span><span class="n">ff</span><span class="p">))</span> <span class="c1">#q is this node of edge eo[0]</span>
            <span class="n">EF</span><span class="p">[</span><span class="n">eo</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(([</span><span class="n">eo</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">ff</span><span class="p">))</span> <span class="c1">#eo[1] is the other node of edge eo[0]</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">unbalanced</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">EF</span>

<span class="k">def</span> <span class="nf">format_ef</span><span class="p">(</span><span class="n">EF</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
    <span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pformat</span>
    <span class="n">e_f</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">([[(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="n">norm</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">e</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="n">EF</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">EF</span><span class="p">]))</span>
    <span class="n">e_f</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">round</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">e</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">e_f</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">])</span>
    <span class="n">e_f</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pformat</span><span class="p">(</span><span class="n">e_f</span><span class="p">)</span>

<span class="n">EF</span> <span class="o">=</span> <span class="n">no_revolution</span><span class="p">()</span>
<span class="n">EF</span> <span class="o">=</span> <span class="n">no_translation</span><span class="p">(</span><span class="n">EF</span><span class="p">)</span>
<span class="n">format_ef</span><span class="p">(</span><span class="n">EF</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Here are the resulting forces along the edges:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 5%" />
<col style="width: 8%" />
<col style="width: 9%" />
<col style="width: 8%" />
<col style="width: 9%" />
<col style="width: 5%" />
<col style="width: 9%" />
<col style="width: 5%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>0</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="head"><p>6</p></th>
<th class="head"><p>7</p></th>
<th class="head"><p>8</p></th>
<th class="head"><p>9</p></th>
<th class="head"><p>10</p></th>
<th class="head"><p>11</p></th>
<th class="head"><p>12</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>116.67</p></td>
<td><p>155.56</p></td>
<td><p>194.44</p></td>
<td><p>0.0</p></td>
<td><p>16.67</p></td>
<td><p>177.78</p></td>
<td><p>27.78</p></td>
<td><p>155.56</p></td>
<td><p>0.0</p></td>
<td><p>177.78</p></td>
<td><p>0.0</p></td>
<td><p>222.22</p></td>
<td><p>133.33</p></td>
</tr>
</tbody>
</table>
</div>
