(self.webpackChunk_hadim_jupyter_archive=self.webpackChunk_hadim_jupyter_archive||[]).push([[261],{261:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var o=r(635),n=r(810),a=r(67),c=r(860),i=r(834),s=r(850),d=r(510),l=r(173);const h=new l.LabIcon({name:"jupyter-archive:archive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16px" height="16px"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="black" d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z"/></svg>'}),m=new l.LabIcon({name:"jupyter-archive:unarchive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><path d="M0 0h24v24H0z" fill="none"/><path class="jp-icon3" fill="black" d="M20.55 5.22l-1.39-1.68A1.51 1.51 0 0018 3H6c-.47 0-.88.21-1.15.55L3.46 5.22C3.17 5.57 3 6.01 3 6.5V19a2 2 0 002 2h14c1.1 0 2-.9 2-2V6.5c0-.49-.17-.93-.45-1.28zM12 9.5l5.5 5.5H14v2h-4v-2H6.5L12 9.5zM5.12 5l.82-1h12l.93 1H5.12z"/></svg>'});var u;function p(e,t,r,o){const a=i.ServerConnection.makeSettings().baseUrl;let c=n.URLExt.join(a,"directories",n.URLExt.encodeParts(e));const s=new URL(c),d=()=>Math.random().toString(36).substr(2);s.searchParams.append("archiveToken",(20,(d()+d()+d()+d()).substr(0,20))),s.searchParams.append("archiveFormat",t),s.searchParams.append("followSymlinks",r),s.searchParams.append("downloadHidden",o);const l=document.cookie.match("\\b_xsrf=([^;]*)\\b");l&&s.searchParams.append("_xsrf",l[1]),c=s.toString();const h=window.chrome;if(h&&(h.webstore||h.runtime))window.open(c);else{const e=document.createElement("a");document.body.appendChild(e),e.setAttribute("href",c),e.setAttribute("download",""),e.click(),document.body.removeChild(e)}}!function(e){e.downloadArchive="filebrowser:download-archive",e.extractArchive="filebrowser:extract-archive",e.downloadArchiveCurrentFolder="filebrowser:download-archive-current-folder"}(u||(u={}));const v={id:"@hadim/jupyter-archive:archive",autoStart:!0,requires:[c.IFileBrowserFactory,a.ISettingRegistry],activate:(e,t,r)=>{console.log("JupyterLab extension jupyter-archive is activated!");const{commands:a}=e,{tracker:c}=t,l=[".zip",".tgz",".tar.gz",".tbz",".tbz2",".tar.bz",".tar.bz2",".txz",".tar.xz"];let v,w,f;const g=".jp-DirListing-content",x='.jp-DirListing-item[data-isdir="true"]',b=new d.Menu({commands:a});b.title.label="Download As",b.title.icon=h;const k=new d.Menu({commands:a});let C,z;function A(t,r){t!==r&&(null!==t&&null!=r||(void 0!==r&&(C.dispose(),z.dispose()),null===t?(C=e.contextMenu.addItem({selector:x,rank:10,type:"submenu",submenu:b}),z=e.contextMenu.addItem({selector:g,rank:3,type:"submenu",submenu:k})):(C=e.contextMenu.addItem({command:u.downloadArchive,selector:x,rank:10}),z=e.contextMenu.addItem({command:u.downloadArchiveCurrentFolder,selector:g,rank:3}))),v=t)}k.title.label="Download Current Folder As",k.title.icon=h,["zip","tar.bz2","tar.gz","tar.xz"].forEach((e=>{b.addItem({command:u.downloadArchive,args:{format:e}}),k.addItem({command:u.downloadArchiveCurrentFolder,args:{format:e}})})),r.load("@hadim/jupyter-archive:archive").then((e=>{e.changed.connect((e=>{A(e.get("format").composite,v),w=e.get("followSymlinks").composite,f=e.get("downloadHidden").composite})),A(e.get("format").composite,v),w=e.get("followSymlinks").composite,f=e.get("downloadHidden").composite})).catch((e=>{console.error(e),(0,o.showErrorMessage)("Fail to read settings for '@hadim/jupyter-archive:archive'",e)})),a.addCommand(u.downloadArchive,{execute:e=>{const t=c.currentWidget;t&&(0,s.each)(t.selectedItems(),(t=>{if("directory"===t.type){const r=e.format;p(t.path,l.indexOf("."+r)>=0?r:v,w,f)}}))},icon:e=>"format"in e?"":h,label:e=>{const t=(e.format||"").replace("."," ").toLocaleUpperCase();return t?`${t} Archive`:"Download as an Archive"}}),a.addCommand(u.extractArchive,{execute:()=>{const e=c.currentWidget;e&&(0,s.each)(e.selectedItems(),(e=>{!function(e){const t=i.ServerConnection.makeSettings(),r=t.baseUrl;let o=n.URLExt.join(r,"extract-archive",n.URLExt.encodeParts(e));const a=new URL(o),c=document.cookie.match("\\b_xsrf=([^;]*)\\b");c&&a.searchParams.append("_xsrf",c[1]),o=a.toString(),i.ServerConnection.makeRequest(o,{method:"GET"},t).then((e=>{if(200!==e.status)throw new i.ServerConnection.ResponseError(e)}))}(e.path)}))},icon:m,isVisible:()=>{const e=c.currentWidget;let t=!1;if(e){const r=e.selectedItems().next(),o=n.PathExt.basename(r.path),a=o.split(".");let c="";a.length>=2&&(c="."+a.splice(a.length-2,2).join(".")),t=l.indexOf(n.PathExt.extname(o))>=0||l.indexOf(c)>=0}return t},label:"Extract Archive"}),e.contextMenu.addItem({command:u.extractArchive,selector:'.jp-DirListing-item[data-isdir="false"]',rank:10}),a.addCommand(u.downloadArchiveCurrentFolder,{execute:e=>{const t=c.currentWidget;if(t){const r=e.format;p(t.model.path,l.indexOf("."+r)>=0?r:v,w,f)}},icon:e=>"format"in e?"":h,label:e=>{const t=(e.format||"").replace("."," ").toLocaleUpperCase();return t?`${t} Archive`:"Download Current Folder as an Archive"}})}}}}]);