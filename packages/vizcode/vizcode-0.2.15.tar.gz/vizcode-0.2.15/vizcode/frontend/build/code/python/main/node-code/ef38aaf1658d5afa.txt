def update_db_after_payment():    organization_id = request.form.get('organization_id')    project_id = request.form.get('project_id')    donor_name = request.form.get('name')    donor_email = request.form.get('email')    newspaper_article_link = request.form.get('article_link')    amount_donated = float(request.form.get('amount'))    amount_paid_to_charity = 0.92 * amount_donated  # $9.20    amount_paid_to_publisher = 0.04 * amount_donated  # $0.40    donation_date_time = datetime.now()    article = Article.query.filter_by(article_link=newspaper_article_link).first()    if article:        newspaper_id = article.publisher_id        newspaper_article_title = article.article_title    else:        return jsonify("Article Does Not Exist.")    organization = Organization.query.filter_by(email=organization_id).first()    if organization:        organization.total_amount_raised += amount_paid_to_charity    else:        return jsonify("Organization Does Not Exist.")    project = Project.query.filter_by(project_id=project_id).first()    if project:        project.project_raised += amount_paid_to_charity        project.funds_available += amount_paid_to_charity    else:        return jsonify("Initiative Does Not Exist.")    publisher = Publisher.query.filter_by(publisher_name=newspaper_id).first()    if publisher:        publisher.commissions_available += amount_paid_to_publisher        publisher.commissions_raised += amount_paid_to_publisher    else:        return jsonify("Publisher Does Not Exist")    # need to make sure the 4 foreign keys reference existing values before adding the donation    donation = Donation(        organization_id=organization_id,        project_id=project_id,        fund_name=None,        donation_date_time=donation_date_time,        donor_name=donor_name,        donor_email=donor_email,        amount_donated=amount_donated,        newspaper_id=newspaper_id,        newspaper_article_title=newspaper_article_title,        newspaper_article_link=newspaper_article_link    )    # send the donor an email    msg = Message()    msg.subject = 'Thank you for Donating!'    msg.html = render_template('payment.html', name=donor_name,                               amount=int(amount_donated), project=project.project_name,                               organization=organization.organization_name)    msg.recipients = [donor_email]    msg.bcc = ["founders@newspark.us"]    msg.sender = "founders@newspark.us"    mail.send(msg)    db.session.add(donation)    db.session.commit()    # subscribe donor to newsletter    url = 'https://us10.api.mailchimp.com/3.0/lists/9f21c018ec/members/'    data = {        "email_address": donor_email,        "status": "subscribed",        "merge_fields": {            "FNAME": donor_name.split(' ')[0],            "LNAME": donor_name.split(' ')[1]        }    }    r = requests.post(url, json=data, auth=('newspark', application.config['MAILCHIMP_API_KEY']))    # print(r.status_code)    return jsonify("Success")