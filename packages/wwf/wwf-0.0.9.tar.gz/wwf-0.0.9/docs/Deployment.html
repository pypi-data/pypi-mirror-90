---

title: 02 - Deployment


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/course2020/vision/02_Deployment.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/course2020/vision/02_Deployment.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Lesson-Video:">Lesson Video:<a class="anchor-link" href="#Lesson-Video:"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/_SKqrTlXNt8?start=2853"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><a href="https://www.starlette.io/">Starlette</a></li>
<li>Follow the <code>Render</code> tutorial <a href="https://github.com/render-examples/fastai-v3">here</a></li>
<li><p><a href="https://github.com/muellerzr/fastai2-Starlette">Link</a> to a fastai template</p>
</li>
<li><p><strong>Note</strong>: You do not <strong>need</strong> to deploy on Render to get the code working, we can test locally on our machine! (which we will do today)</p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="What-will-we-focus-on?">What will we focus on?<a class="anchor-link" href="#What-will-we-focus-on?"> </a></h2><ul>
<li>Looking at how to format inputs/outputs for each model type and feeding it in. </li>
<li>Images, Tabular, NLP</li>
</ul>
<h2 id="What-code-do-we-change?">What code do we change?<a class="anchor-link" href="#What-code-do-we-change?"> </a></h2><ul>
<li><code>server.py</code></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Images:">Images:<a class="anchor-link" href="#Images:"> </a></h2><ul>
<li>Different input types:<ul>
<li>URL</li>
<li>File upload</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_bytes</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
  <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
      <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>An image upload</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/analyze&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="n">img_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">()</span>
  <span class="n">img_bytes</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span><span class="n">img_data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
  <span class="n">pred</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">img_bytes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
      <span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
  <span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A URL</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/analyze&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="n">img_bytes</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_bytes</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">])</span>
  <span class="n">pred</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">img_bytes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
      <span class="s1">&#39;results&#39;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
  <span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A zip file (see below on how to upload a <code>zip</code> or other file</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/analyze&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">()</span>
  <span class="n">content</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span>
  <span class="n">zip_ref</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
  <span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;Downloaded_Images&#39;</span><span class="p">)</span>
  <span class="n">zipref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;Downloaded_Images&#39;</span><span class="p">)</span>
  <span class="n">zip_ref</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;Downloaded_Images&#39;</span><span class="p">)</span>
  <span class="n">imgs</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="n">learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="n">export_file_name</span><span class="p">)</span>
  <span class="n">dl</span> <span class="o">=</span> <span class="n">test_dl</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">dls</span><span class="p">,</span> <span class="n">imgs</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">get_preds</span><span class="p">(</span><span class="n">dl</span><span class="o">=</span><span class="n">dl</span><span class="p">,</span> <span class="n">with_decoded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;Downloaded_Images&#39;</span>
  <span class="n">resultsFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;results.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
  <span class="n">wr</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">resultsFile</span><span class="p">)</span>
  <span class="n">wr</span><span class="o">.</span><span class="n">writerows</span><span class="p">([</span><span class="n">preds</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">FileResponse</span><span class="p">(</span><span class="s1">&#39;results.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Parsing a csv with image urls</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">StringIO</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/analyze&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">()</span>
  <span class="n">content</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
  <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
  <span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;Downloaded_Images&#39;</span><span class="p">)</span>
  <span class="n">download_images</span><span class="p">(</span><span class="s1">&#39;Downloaded_Images&#39;</span><span class="p">,</span> <span class="n">urls</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
  <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;Downloaded_Images&#39;</span><span class="p">)</span>
  <span class="n">learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="n">export_file_name</span><span class="p">)</span>
  <span class="n">imgs</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
  <span class="n">dl</span> <span class="o">=</span> <span class="n">test_dl</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">dls</span><span class="p">,</span> <span class="n">imgs</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">get_preds</span><span class="p">(</span><span class="n">dl</span><span class="o">=</span><span class="n">dl</span><span class="p">,</span> <span class="n">with_decoded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="s1">&#39;Downloaded_Images&#39;</span>
  <span class="n">resultsFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;results.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
  <span class="n">wr</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">resultsFile</span><span class="p">)</span>
  <span class="n">wr</span><span class="o">.</span><span class="n">writerows</span><span class="p">([</span><span class="n">preds</span><span class="p">])</span>
  <span class="k">return</span> <span class="n">FileResponse</span><span class="p">(</span><span class="s1">&#39;results.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Tabular">Tabular<a class="anchor-link" href="#Tabular"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Tabular is different. Most work will be done by sending large chuncks of data for analysis. Let's recreate what we did, but load it into Pandas</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">StringIO</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/analyze&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">()</span>
  <span class="n">content</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
  <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">learn</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="n">export_file_name</span><span class="p">)</span>
  <span class="c1"># if we want to do GPU:</span>
  <span class="c1"># learn.model = learn.model.cuda()</span>
  <span class="n">dl</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">train_dl</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">get_preds</span><span class="p">(</span><span class="n">dl</span><span class="o">=</span><span class="n">dl</span><span class="p">,</span> <span class="n">with_decoded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Predictions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
  <span class="c1"># if we want to store the results</span>
  <span class="n">path_res</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;app/static/&#39;</span><span class="p">)</span>
  <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_res</span><span class="o">/</span><span class="s1">&#39;results.csv&#39;</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">FileResponse</span><span class="p">(</span><span class="s1">&#39;results.csv&#39;</span><span class="p">,</span> <span class="n">media_type</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to adjust the JavaScript to accept a form:</p>
<p><code>client.js</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">function</span> <span class="n">analyze</span><span class="p">(){</span>
    <span class="n">var</span> <span class="n">uploadFiles</span> <span class="o">=</span> <span class="n">el</span><span class="p">(</span><span class="s1">&#39;file-input&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">files</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">uploadFiles</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="n">alert</span><span class="p">(</span><span class="s1">&#39;Please select 1 file to analyze!&#39;</span><span class="p">);</span>

    <span class="n">el</span><span class="p">(</span><span class="s1">&#39;analyze-button&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;Analyzing...&#39;</span><span class="p">;</span>
    <span class="n">var</span> <span class="n">xhr</span> <span class="o">=</span> <span class="n">new</span> <span class="n">XMLHttpRequest</span><span class="p">();</span>
    <span class="n">var</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">location</span>
    <span class="n">xhr</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="err">`$</span><span class="p">{</span><span class="n">loc</span><span class="o">.</span><span class="n">protocol</span><span class="p">}</span><span class="o">//</span><span class="err">$</span><span class="p">{</span><span class="n">loc</span><span class="o">.</span><span class="n">hostname</span><span class="p">}:</span><span class="err">$</span><span class="p">{</span><span class="n">loc</span><span class="o">.</span><span class="n">port</span><span class="p">}</span><span class="o">/</span><span class="n">analyze</span><span class="err">`</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>
    <span class="n">xhr</span><span class="o">.</span><span class="n">onerror</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span><span class="n">alert</span> <span class="p">(</span><span class="n">xhr</span><span class="o">.</span><span class="n">responseText</span><span class="p">);}</span>
    <span class="n">xhr</span><span class="o">.</span><span class="n">onload</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">el</span><span class="p">(</span><span class="s2">&quot;result-label&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">innerHTML</span> <span class="o">=</span> <span class="err">`</span><span class="n">Result</span> <span class="o">=</span> <span class="n">Good</span><span class="err">`</span><span class="p">;</span>
          
          <span class="n">download</span><span class="p">(</span><span class="s1">&#39;results.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;results.csv&#39;</span><span class="p">);</span>
          <span class="n">xhr</span><span class="o">.</span><span class="n">send</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="n">el</span><span class="p">(</span><span class="s2">&quot;analyze-button&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;Analyze&quot;</span><span class="p">;</span>
      <span class="p">};</span>

      <span class="n">var</span> <span class="n">fileData</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FormData</span><span class="p">();</span>
      <span class="n">fileData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="n">uploadFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="n">xhr</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">fileData</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Text">Text<a class="anchor-link" href="#Text"> </a></h2><p>To write a simple function for text based models:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/analyze&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
  <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">()</span>
  <span class="n">content</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span>
  <span class="n">pred</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">content</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="n">pred</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

