---

title: Lesson 4 - DataBlock Summary


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/course2020/vision/04_DBlock_Summary.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/course2020/vision/04_DBlock_Summary.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Lesson-Video:">Lesson Video:<a class="anchor-link" href="#Lesson-Video:"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/X4Bp7gMPx_E?start=2873"
            frameborder="0"
            allowfullscreen
        ></iframe>
        
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea output_execute_result">
<hr>
<p>This article is also a Jupyter Notebook available to be run from the top down. There
will be code snippets that you can then run in any environment.</p>
<p>Below are the versions of <code>fastai</code>, <code>fastcore</code>, and <code>wwf</code> currently running at the time of writing this:</p>
<ul>
<li><code>fastai</code>: 2.1.10 </li>
<li><code>fastcore</code>: 1.3.13 </li>
<li><code>wwf</code>: 0.0.7 </li>
</ul>
<hr>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this notebook we'll be looking at <code>dblock.summary</code> and how to interpret it</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Libraries for today:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.vision.all</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Below you will find the exact imports for everything we use today</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastcore.transform</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="kn">from</span> <span class="nn">fastai.data.block</span> <span class="kn">import</span> <span class="n">CategoryBlock</span><span class="p">,</span> <span class="n">DataBlock</span>
<span class="kn">from</span> <span class="nn">fastai.data.core</span> <span class="kn">import</span> <span class="n">Datasets</span>
<span class="kn">from</span> <span class="nn">fastai.data.external</span> <span class="kn">import</span> <span class="n">untar_data</span><span class="p">,</span> <span class="n">URLs</span>
<span class="kn">from</span> <span class="nn">fastai.data.transforms</span> <span class="kn">import</span> <span class="n">Categorize</span><span class="p">,</span> <span class="n">GrandparentSplitter</span><span class="p">,</span> <span class="n">IntToFloatTensor</span><span class="p">,</span> <span class="n">Normalize</span><span class="p">,</span> <span class="n">RandomSplitter</span><span class="p">,</span> <span class="n">ToTensor</span><span class="p">,</span> <span class="n">parent_label</span>

<span class="kn">from</span> <span class="nn">fastai.torch_core</span> <span class="kn">import</span> <span class="n">to_device</span>

<span class="kn">from</span> <span class="nn">fastai.vision.augment</span> <span class="kn">import</span> <span class="n">aug_transforms</span><span class="p">,</span> <span class="n">Resize</span><span class="p">,</span> <span class="n">RandomResizedCrop</span><span class="p">,</span> <span class="n">FlipItem</span>
<span class="kn">from</span> <span class="nn">fastai.vision.data</span> <span class="kn">import</span> <span class="n">ImageBlock</span><span class="p">,</span> <span class="n">PILImage</span><span class="p">,</span> <span class="n">get_image_files</span><span class="p">,</span> <span class="n">imagenet_stats</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Getting-the-Dataset">Getting the Dataset<a class="anchor-link" href="#Getting-the-Dataset"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll use <code>ImageWoof</code> like we did in previous notebooks</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">IMAGEWOOF</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And create our label dictionary similarly</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lbl_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
  <span class="n">n02086240</span><span class="o">=</span> <span class="s1">&#39;Shih-Tzu&#39;</span><span class="p">,</span>
  <span class="n">n02087394</span><span class="o">=</span> <span class="s1">&#39;Rhodesian ridgeback&#39;</span><span class="p">,</span>
  <span class="n">n02088364</span><span class="o">=</span> <span class="s1">&#39;Beagle&#39;</span><span class="p">,</span>
  <span class="n">n02089973</span><span class="o">=</span> <span class="s1">&#39;English foxhound&#39;</span><span class="p">,</span>
  <span class="n">n02093754</span><span class="o">=</span> <span class="s1">&#39;Australian terrier&#39;</span><span class="p">,</span>
  <span class="n">n02096294</span><span class="o">=</span> <span class="s1">&#39;Border terrier&#39;</span><span class="p">,</span>
  <span class="n">n02099601</span><span class="o">=</span> <span class="s1">&#39;Golden retriever&#39;</span><span class="p">,</span>
  <span class="n">n02105641</span><span class="o">=</span> <span class="s1">&#39;Old English sheepdog&#39;</span><span class="p">,</span>
  <span class="n">n02111889</span><span class="o">=</span> <span class="s1">&#39;Samoyed&#39;</span><span class="p">,</span>
  <span class="n">n02115641</span><span class="o">=</span> <span class="s1">&#39;Dingo&#39;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Some minimal transforms to get us by</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item_tfms</span> <span class="o">=</span> <span class="n">Resize</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="n">batch_tfms</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">aug_transforms</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span> <span class="n">max_warp</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">Normalize</span><span class="o">.</span><span class="n">from_stats</span><span class="p">(</span><span class="o">*</span><span class="n">imagenet_stats</span><span class="p">)]</span>
<span class="n">bs</span><span class="o">=</span><span class="mi">64</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And our <a href="https://docs.fast.ai/data.block#DataBlock"><code>DataBlock</code></a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pets</span> <span class="o">=</span> <span class="n">DataBlock</span><span class="p">(</span><span class="n">blocks</span><span class="o">=</span><span class="p">(</span><span class="n">ImageBlock</span><span class="p">,</span> <span class="n">CategoryBlock</span><span class="p">),</span>
                 <span class="n">get_items</span><span class="o">=</span><span class="n">get_image_files</span><span class="p">,</span>
                 <span class="n">splitter</span><span class="o">=</span><span class="n">RandomSplitter</span><span class="p">(),</span>
                 <span class="n">get_y</span><span class="o">=</span><span class="n">Pipeline</span><span class="p">([</span><span class="n">parent_label</span><span class="p">,</span> <span class="n">lbl_dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">]),</span>
                 <span class="n">item_tfms</span><span class="o">=</span><span class="n">item_tfms</span><span class="p">,</span>
                 <span class="n">batch_tfms</span><span class="o">=</span><span class="n">batch_tfms</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Using-Summary">Using <code>Summary</code><a class="anchor-link" href="#Using-Summary"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now to run <code>.summary</code>, we need to send in what our <a href="https://docs.fast.ai/data.block#DataBlock"><code>DataBlock</code></a> expects. In this case it's a path (think how we make our <a href="https://docs.fast.ai/data.core#DataLoaders"><code>DataLoaders</code></a> from the <a href="https://docs.fast.ai/data.block#DataBlock"><code>DataBlock</code></a>)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pets</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Setting-up type transforms pipelines
Collecting items from /root/.fastai/data/imagewoof2
Found 12954 items
2 datasets of sizes 10364,2590
Setting up Pipeline: PILBase.create
Setting up Pipeline: parent_label -&gt; dict.__getitem__ -&gt; Categorize -- {&#39;vocab&#39;: None, &#39;sort&#39;: True, &#39;add_na&#39;: False}

Building one sample
  Pipeline: PILBase.create
    starting from
      /root/.fastai/data/imagewoof2/train/n02086240/n02086240_6168.JPEG
    applying PILBase.create gives
      PILImage mode=RGB size=500x375
  Pipeline: parent_label -&gt; dict.__getitem__ -&gt; Categorize -- {&#39;vocab&#39;: None, &#39;sort&#39;: True, &#39;add_na&#39;: False}
    starting from
      /root/.fastai/data/imagewoof2/train/n02086240/n02086240_6168.JPEG
    applying parent_label gives
      n02086240
    applying dict.__getitem__ gives
      Shih-Tzu
    applying Categorize -- {&#39;vocab&#39;: None, &#39;sort&#39;: True, &#39;add_na&#39;: False} gives
      TensorCategory(9)

Final sample: (PILImage mode=RGB size=500x375, TensorCategory(9))


Collecting items from /root/.fastai/data/imagewoof2
Found 12954 items
2 datasets of sizes 10364,2590
Setting up Pipeline: PILBase.create
Setting up Pipeline: parent_label -&gt; dict.__getitem__ -&gt; Categorize -- {&#39;vocab&#39;: None, &#39;sort&#39;: True, &#39;add_na&#39;: False}
Setting up after_item: Pipeline: Resize -- {&#39;size&#39;: (128, 128), &#39;method&#39;: &#39;crop&#39;, &#39;pad_mode&#39;: &#39;reflection&#39;, &#39;resamples&#39;: (2, 0), &#39;p&#39;: 1.0} -&gt; ToTensor
Setting up before_batch: Pipeline: 
Setting up after_batch: Pipeline: IntToFloatTensor -- {&#39;div&#39;: 255.0, &#39;div_mask&#39;: 1} -&gt; Flip -- {&#39;size&#39;: 224, &#39;mode&#39;: &#39;bilinear&#39;, &#39;pad_mode&#39;: &#39;reflection&#39;, &#39;mode_mask&#39;: &#39;nearest&#39;, &#39;align_corners&#39;: True, &#39;p&#39;: 0.5} -&gt; Brightness -- {&#39;max_lighting&#39;: 0.2, &#39;p&#39;: 1.0, &#39;draw&#39;: None, &#39;batch&#39;: False} -&gt; Normalize -- {&#39;mean&#39;: tensor([[[[0.4850]],

         [[0.4560]],

         [[0.4060]]]], device=&#39;cuda:0&#39;), &#39;std&#39;: tensor([[[[0.2290]],

         [[0.2240]],

         [[0.2250]]]], device=&#39;cuda:0&#39;), &#39;axes&#39;: (0, 2, 3)}

Building one batch
Applying item_tfms to the first sample:
  Pipeline: Resize -- {&#39;size&#39;: (128, 128), &#39;method&#39;: &#39;crop&#39;, &#39;pad_mode&#39;: &#39;reflection&#39;, &#39;resamples&#39;: (2, 0), &#39;p&#39;: 1.0} -&gt; ToTensor
    starting from
      (PILImage mode=RGB size=500x375, TensorCategory(9))
    applying Resize -- {&#39;size&#39;: (128, 128), &#39;method&#39;: &#39;crop&#39;, &#39;pad_mode&#39;: &#39;reflection&#39;, &#39;resamples&#39;: (2, 0), &#39;p&#39;: 1.0} gives
      (PILImage mode=RGB size=128x128, TensorCategory(9))
    applying ToTensor gives
      (TensorImage of size 3x128x128, TensorCategory(9))

Adding the next 3 samples

No before_batch transform to apply

Collating items in a batch

Applying batch_tfms to the batch built
  Pipeline: IntToFloatTensor -- {&#39;div&#39;: 255.0, &#39;div_mask&#39;: 1} -&gt; Flip -- {&#39;size&#39;: 224, &#39;mode&#39;: &#39;bilinear&#39;, &#39;pad_mode&#39;: &#39;reflection&#39;, &#39;mode_mask&#39;: &#39;nearest&#39;, &#39;align_corners&#39;: True, &#39;p&#39;: 0.5} -&gt; Brightness -- {&#39;max_lighting&#39;: 0.2, &#39;p&#39;: 1.0, &#39;draw&#39;: None, &#39;batch&#39;: False} -&gt; Normalize -- {&#39;mean&#39;: tensor([[[[0.4850]],

         [[0.4560]],

         [[0.4060]]]], device=&#39;cuda:0&#39;), &#39;std&#39;: tensor([[[[0.2290]],

         [[0.2240]],

         [[0.2250]]]], device=&#39;cuda:0&#39;), &#39;axes&#39;: (0, 2, 3)}
    starting from
      (TensorImage of size 4x3x128x128, TensorCategory([9, 9, 5, 0], device=&#39;cuda:0&#39;))
    applying IntToFloatTensor -- {&#39;div&#39;: 255.0, &#39;div_mask&#39;: 1} gives
      (TensorImage of size 4x3x128x128, TensorCategory([9, 9, 5, 0], device=&#39;cuda:0&#39;))
    applying Flip -- {&#39;size&#39;: 224, &#39;mode&#39;: &#39;bilinear&#39;, &#39;pad_mode&#39;: &#39;reflection&#39;, &#39;mode_mask&#39;: &#39;nearest&#39;, &#39;align_corners&#39;: True, &#39;p&#39;: 0.5} gives
      (TensorImage of size 4x3x224x224, TensorCategory([9, 9, 5, 0], device=&#39;cuda:0&#39;))
    applying Brightness -- {&#39;max_lighting&#39;: 0.2, &#39;p&#39;: 1.0, &#39;draw&#39;: None, &#39;batch&#39;: False} gives
      (TensorImage of size 4x3x224x224, TensorCategory([9, 9, 5, 0], device=&#39;cuda:0&#39;))
    applying Normalize -- {&#39;mean&#39;: tensor([[[[0.4850]],

         [[0.4560]],

         [[0.4060]]]], device=&#39;cuda:0&#39;), &#39;std&#39;: tensor([[[[0.2290]],

         [[0.2240]],

         [[0.2250]]]], device=&#39;cuda:0&#39;), &#39;axes&#39;: (0, 2, 3)} gives
      (TensorImage of size 4x3x224x224, TensorCategory([9, 9, 5, 0], device=&#39;cuda:0&#39;))
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Debugging-without-the-DataBlock">Debugging without the DataBlock<a class="anchor-link" href="#Debugging-without-the-DataBlock"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What we find is it will go through <strong>each</strong> and every single part of our <a href="https://docs.fast.ai/data.block#DataBlock"><code>DataBlock</code></a>, test it on an item, and we can see what popped out! <strong>But!</strong> What if we are using the <a href="https://docs.fast.ai/data.core#Datasets"><code>Datasets</code></a> instead? Let's go through how to utilize it</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tfms</span> <span class="o">=</span> <span class="p">[[</span><span class="n">PILImage</span><span class="o">.</span><span class="n">create</span><span class="p">],</span> <span class="p">[</span><span class="n">parent_label</span><span class="p">,</span> <span class="n">Categorize</span><span class="p">()]]</span>
<span class="n">item_tfms</span> <span class="o">=</span> <span class="p">[</span><span class="n">ToTensor</span><span class="p">(),</span> <span class="n">Resize</span><span class="p">(</span><span class="mi">128</span><span class="p">)]</span>
<span class="n">batch_tfms</span> <span class="o">=</span> <span class="p">[</span><span class="n">FlipItem</span><span class="p">(),</span> <span class="n">RandomResizedCrop</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">min_scale</span><span class="o">=</span><span class="mf">0.35</span><span class="p">),</span>
              <span class="n">IntToFloatTensor</span><span class="p">(),</span> <span class="n">Normalize</span><span class="o">.</span><span class="n">from_stats</span><span class="p">(</span><span class="o">*</span><span class="n">imagenet_stats</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">split_idx</span> <span class="o">=</span> <span class="n">GrandparentSplitter</span><span class="p">(</span><span class="n">valid_name</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="p">)(</span><span class="n">items</span><span class="p">)</span>
<span class="n">dsets</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">tfms</span><span class="p">,</span> <span class="n">splits</span><span class="o">=</span><span class="n">split_idx</span><span class="p">)</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">dsets</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">after_item</span><span class="o">=</span><span class="n">item_tfms</span><span class="p">,</span> <span class="n">after_batch</span><span class="o">=</span><span class="n">batch_tfms</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll want to grab the first item from our set</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">dsets</span><span class="o">.</span><span class="n">train</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(PILImage mode=RGB size=360x303, TensorCategory(6))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And pass it into any <code>after_item</code> or <code>after_batch</code> transform <a href="https://fastcore.fast.ai/transform#Pipeline"><code>Pipeline</code></a>. We can list them by calling them</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">after_item</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Pipeline: Resize -- {&#39;size&#39;: (128, 128), &#39;method&#39;: &#39;crop&#39;, &#39;pad_mode&#39;: &#39;reflection&#39;, &#39;resamples&#39;: (2, 0), &#39;p&#39;: 1.0} -&gt; ToTensor</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">after_batch</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Pipeline: FlipItem -- {&#39;p&#39;: 0.5} -&gt; RandomResizedCrop -- {&#39;size&#39;: (128, 128), &#39;min_scale&#39;: 0.35, &#39;ratio&#39;: (0.75, 1.3333333333333333), &#39;resamples&#39;: (2, 0), &#39;val_xtra&#39;: 0.14, &#39;p&#39;: 1.0} -&gt; IntToFloatTensor -- {&#39;div&#39;: 255.0, &#39;div_mask&#39;: 1} -&gt; Normalize -- {&#39;mean&#39;: tensor([[[[0.4850]],

         [[0.4560]],

         [[0.4060]]]], device=&#39;cuda:0&#39;), &#39;std&#39;: tensor([[[[0.2290]],

         [[0.2240]],

         [[0.2250]]]], device=&#39;cuda:0&#39;), &#39;axes&#39;: (0, 2, 3)}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And now we can pass in our item through the <a href="https://fastcore.fast.ai/transform#Pipeline"><code>Pipeline</code></a> like so:</p>
<p>(<code>x[0]</code> has our input and <code>x[1]</code> has our <code>y</code>)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dls</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">after_item</span><span class="p">:</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Resize -- {&#39;size&#39;: (128, 128), &#39;method&#39;: &#39;crop&#39;, &#39;pad_mode&#39;: &#39;reflection&#39;, &#39;resamples&#39;: (2, 0), &#39;p&#39;: 1.0} PILImage mode=RGB size=128x128
ToTensor TensorImage([[[ 16,  20,  24,  ..., 151, 134, 137],
         [ 27,  26,  32,  ..., 146, 151, 136],
         [ 43,  46,  47,  ..., 123, 142, 143],
         ...,
         [145, 134, 106,  ...,  51,  37,  27],
         [ 38,  55,  46,  ...,  33,  35,  23],
         [ 64,  85,  66,  ...,  33,  53,  56]],

        [[ 18,  18,  22,  ..., 150, 132, 135],
         [ 29,  25,  30,  ..., 144, 149, 134],
         [ 46,  44,  45,  ..., 119, 140, 141],
         ...,
         [143, 144, 117,  ...,  71,  77,  67],
         [ 51,  78,  75,  ...,  49,  50,  37],
         [ 76, 105,  89,  ...,  50,  67,  69]],

        [[ 29,  32,  36,  ..., 106,  90,  94],
         [ 40,  38,  44,  ..., 107, 109,  93],
         [ 56,  58,  59,  ...,  90, 100, 100],
         ...,
         [142, 121,  92,  ...,  61,  54,  45],
         [ 42,  67,  45,  ...,  38,  39,  26],
         [ 61,  89,  61,  ...,  33,  55,  59]]], dtype=torch.uint8)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dls</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">after_batch</span><span class="p">:</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">to_device</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;cuda&#39;</span><span class="p">))</span> <span class="c1"># we need to move our data to the GPU</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>FlipItem -- {&#39;p&#39;: 0.5} TensorImage([[[0.0627, 0.0784, 0.0941,  ..., 0.5922, 0.5255, 0.5373],
         [0.1059, 0.1020, 0.1255,  ..., 0.5725, 0.5922, 0.5333],
         [0.1686, 0.1804, 0.1843,  ..., 0.4824, 0.5569, 0.5608],
         ...,
         [0.5686, 0.5255, 0.4157,  ..., 0.2000, 0.1451, 0.1059],
         [0.1490, 0.2157, 0.1804,  ..., 0.1294, 0.1373, 0.0902],
         [0.2510, 0.3333, 0.2588,  ..., 0.1294, 0.2078, 0.2196]],

        [[0.0706, 0.0706, 0.0863,  ..., 0.5882, 0.5176, 0.5294],
         [0.1137, 0.0980, 0.1176,  ..., 0.5647, 0.5843, 0.5255],
         [0.1804, 0.1725, 0.1765,  ..., 0.4667, 0.5490, 0.5529],
         ...,
         [0.5608, 0.5647, 0.4588,  ..., 0.2784, 0.3020, 0.2627],
         [0.2000, 0.3059, 0.2941,  ..., 0.1922, 0.1961, 0.1451],
         [0.2980, 0.4118, 0.3490,  ..., 0.1961, 0.2627, 0.2706]],

        [[0.1137, 0.1255, 0.1412,  ..., 0.4157, 0.3529, 0.3686],
         [0.1569, 0.1490, 0.1725,  ..., 0.4196, 0.4275, 0.3647],
         [0.2196, 0.2275, 0.2314,  ..., 0.3529, 0.3922, 0.3922],
         ...,
         [0.5569, 0.4745, 0.3608,  ..., 0.2392, 0.2118, 0.1765],
         [0.1647, 0.2627, 0.1765,  ..., 0.1490, 0.1529, 0.1020],
         [0.2392, 0.3490, 0.2392,  ..., 0.1294, 0.2157, 0.2314]]],
       device=&#39;cuda:0&#39;)
RandomResizedCrop -- {&#39;size&#39;: (128, 128), &#39;min_scale&#39;: 0.35, &#39;ratio&#39;: (0.75, 1.3333333333333333), &#39;resamples&#39;: (2, 0), &#39;val_xtra&#39;: 0.14, &#39;p&#39;: 1.0} TensorImage([[[0.0627, 0.0784, 0.0941,  ..., 0.5922, 0.5255, 0.5373],
         [0.1059, 0.1020, 0.1255,  ..., 0.5725, 0.5922, 0.5333],
         [0.1686, 0.1804, 0.1843,  ..., 0.4824, 0.5569, 0.5608],
         ...,
         [0.5686, 0.5255, 0.4157,  ..., 0.2000, 0.1451, 0.1059],
         [0.1490, 0.2157, 0.1804,  ..., 0.1294, 0.1373, 0.0902],
         [0.2510, 0.3333, 0.2588,  ..., 0.1294, 0.2078, 0.2196]],

        [[0.0706, 0.0706, 0.0863,  ..., 0.5882, 0.5176, 0.5294],
         [0.1137, 0.0980, 0.1176,  ..., 0.5647, 0.5843, 0.5255],
         [0.1804, 0.1725, 0.1765,  ..., 0.4667, 0.5490, 0.5529],
         ...,
         [0.5608, 0.5647, 0.4588,  ..., 0.2784, 0.3020, 0.2627],
         [0.2000, 0.3059, 0.2941,  ..., 0.1922, 0.1961, 0.1451],
         [0.2980, 0.4118, 0.3490,  ..., 0.1961, 0.2627, 0.2706]],

        [[0.1137, 0.1255, 0.1412,  ..., 0.4157, 0.3529, 0.3686],
         [0.1569, 0.1490, 0.1725,  ..., 0.4196, 0.4275, 0.3647],
         [0.2196, 0.2275, 0.2314,  ..., 0.3529, 0.3922, 0.3922],
         ...,
         [0.5569, 0.4745, 0.3608,  ..., 0.2392, 0.2118, 0.1765],
         [0.1647, 0.2627, 0.1765,  ..., 0.1490, 0.1529, 0.1020],
         [0.2392, 0.3490, 0.2392,  ..., 0.1294, 0.2157, 0.2314]]],
       device=&#39;cuda:0&#39;)
IntToFloatTensor -- {&#39;div&#39;: 255.0, &#39;div_mask&#39;: 1} TensorImage([[[0.0002, 0.0003, 0.0004,  ..., 0.0023, 0.0021, 0.0021],
         [0.0004, 0.0004, 0.0005,  ..., 0.0022, 0.0023, 0.0021],
         [0.0007, 0.0007, 0.0007,  ..., 0.0019, 0.0022, 0.0022],
         ...,
         [0.0022, 0.0021, 0.0016,  ..., 0.0008, 0.0006, 0.0004],
         [0.0006, 0.0008, 0.0007,  ..., 0.0005, 0.0005, 0.0004],
         [0.0010, 0.0013, 0.0010,  ..., 0.0005, 0.0008, 0.0009]],

        [[0.0003, 0.0003, 0.0003,  ..., 0.0023, 0.0020, 0.0021],
         [0.0004, 0.0004, 0.0005,  ..., 0.0022, 0.0023, 0.0021],
         [0.0007, 0.0007, 0.0007,  ..., 0.0018, 0.0022, 0.0022],
         ...,
         [0.0022, 0.0022, 0.0018,  ..., 0.0011, 0.0012, 0.0010],
         [0.0008, 0.0012, 0.0012,  ..., 0.0008, 0.0008, 0.0006],
         [0.0012, 0.0016, 0.0014,  ..., 0.0008, 0.0010, 0.0011]],

        [[0.0004, 0.0005, 0.0006,  ..., 0.0016, 0.0014, 0.0014],
         [0.0006, 0.0006, 0.0007,  ..., 0.0016, 0.0017, 0.0014],
         [0.0009, 0.0009, 0.0009,  ..., 0.0014, 0.0015, 0.0015],
         ...,
         [0.0022, 0.0019, 0.0014,  ..., 0.0009, 0.0008, 0.0007],
         [0.0006, 0.0010, 0.0007,  ..., 0.0006, 0.0006, 0.0004],
         [0.0009, 0.0014, 0.0009,  ..., 0.0005, 0.0008, 0.0009]]],
       device=&#39;cuda:0&#39;)
Normalize -- {&#39;mean&#39;: tensor([[[[0.4850]],

         [[0.4560]],

         [[0.4060]]]], device=&#39;cuda:0&#39;), &#39;std&#39;: tensor([[[[0.2290]],

         [[0.2240]],

         [[0.2250]]]], device=&#39;cuda:0&#39;), &#39;axes&#39;: (0, 2, 3)} TensorImage([[[[-2.1168, -2.1166, -2.1163,  ..., -2.1078, -2.1089, -2.1087],
          [-2.1161, -2.1162, -2.1158,  ..., -2.1081, -2.1078, -2.1088],
          [-2.1150, -2.1148, -2.1147,  ..., -2.1096, -2.1084, -2.1083],
          ...,
          [-2.1082, -2.1089, -2.1108,  ..., -2.1145, -2.1154, -2.1161],
          [-2.1154, -2.1142, -2.1148,  ..., -2.1157, -2.1156, -2.1164],
          [-2.1136, -2.1122, -2.1135,  ..., -2.1157, -2.1143, -2.1141]],

         [[-2.0345, -2.0345, -2.0342,  ..., -2.0254, -2.0267, -2.0264],
          [-2.0337, -2.0340, -2.0337,  ..., -2.0258, -2.0255, -2.0265],
          [-2.0326, -2.0327, -2.0326,  ..., -2.0275, -2.0261, -2.0260],
          ...,
          [-2.0259, -2.0258, -2.0277,  ..., -2.0308, -2.0304, -2.0311],
          [-2.0322, -2.0304, -2.0306,  ..., -2.0324, -2.0323, -2.0332],
          [-2.0305, -2.0285, -2.0296,  ..., -2.0323, -2.0311, -2.0310]],

         [[-1.8025, -1.8023, -1.8020,  ..., -1.7972, -1.7983, -1.7980],
          [-1.8017, -1.8018, -1.8014,  ..., -1.7971, -1.7970, -1.7981],
          [-1.8006, -1.8005, -1.8004,  ..., -1.7983, -1.7976, -1.7976],
          ...,
          [-1.7947, -1.7962, -1.7982,  ..., -1.8003, -1.8008, -1.8014],
          [-1.8016, -1.7999, -1.8014,  ..., -1.8018, -1.8018, -1.8027],
          [-1.8003, -1.7984, -1.8003,  ..., -1.8022, -1.8007, -1.8004]]]],
       device=&#39;cuda:0&#39;)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

