(self.webpackChunkjupyter_leaflet=self.webpackChunkjupyter_leaflet||[]).push([[687],{8687:()=>{"use strict";L.DomUtil.setTransform||(L.DomUtil.setTransform=function(t,e,n){var i=e||new L.Point(0,0);t.style[L.DomUtil.TRANSFORM]=(L.Browser.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")}),L.CanvasLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(t){this._map=null,this._canvas=null,this._frame=null,this._delegate=null,L.setOptions(this,t)},delegate:function(t){return this._delegate=t,this},needRedraw:function(){return this._frame||(this._frame=L.Util.requestAnimFrame(this.drawLayer,this)),this},_onLayerDidResize:function(t){this._canvas.width=t.newSize.x,this._canvas.height=t.newSize.y},_onLayerDidMove:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t),this.drawLayer()},getEvents:function(){var t={resize:this._onLayerDidResize,moveend:this._onLayerDidMove};return this._map.options.zoomAnimation&&L.Browser.any3d&&(t.zoomanim=this._animateZoom),t},onAdd:function(t){this._map=t,this._canvas=L.DomUtil.create("canvas","leaflet-layer"),this.tiles={};var e=this._map.getSize();this._canvas.width=e.x,this._canvas.height=e.y;var n=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(n?"animated":"hide")),t._panes.overlayPane.appendChild(this._canvas),t.on(this.getEvents(),this);var i=this._delegate||this;i.onLayerDidMount&&i.onLayerDidMount(),this.needRedraw();var o=this;setTimeout((function(){o._onLayerDidMove()}),0)},onRemove:function(t){var e=this._delegate||this;e.onLayerWillUnmount&&e.onLayerWillUnmount(),t.getPanes().overlayPane.removeChild(this._canvas),t.off(this.getEvents(),this),this._canvas=null},addTo:function(t){return t.addLayer(this),this},LatLonToMercator:function(t){return{x:6378137*t.lng*Math.PI/180,y:6378137*Math.log(Math.tan((90+t.lat)*Math.PI/360))}},drawLayer:function(){var t=this._map.getSize(),e=this._map.getBounds(),n=this._map.getZoom(),i=this.LatLonToMercator(this._map.getCenter()),o=this.LatLonToMercator(this._map.containerPointToLatLng(this._map.getSize())),a=this._delegate||this;a.onDrawLayer&&a.onDrawLayer({layer:this,canvas:this._canvas,bounds:e,size:t,zoom:n,center:i,corner:o}),this._frame=null},_setTransform:function(t,e,n){var i=e||new L.Point(0,0);t.style[L.DomUtil.TRANSFORM]=(L.Browser.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),n=L.Layer?this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),t.zoom,t.center):this._map._getCenterOffset(t.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());L.DomUtil.setTransform(this._canvas,n,e)}}),L.canvasLayer=function(){return new L.CanvasLayer},L.Control.Velocity=L.Control.extend({options:{position:"bottomleft",emptyString:"Unavailable",angleConvention:"bearingCCW",speedUnit:"m/s"},onAdd:function(t){return this._container=L.DomUtil.create("div","leaflet-control-velocity"),L.DomEvent.disableClickPropagation(this._container),t.on("mousemove",this._onMouseMove,this),this._container.innerHTML=this.options.emptyString,this._container},onRemove:function(t){t.off("mousemove",this._onMouseMove,this)},vectorToSpeed:function(t,e,n){var i=Math.sqrt(Math.pow(t,2)+Math.pow(e,2));return"k/h"===n?this.meterSec2kilometerHour(i):"kt"===n?this.meterSec2Knots(i):i},vectorToDegrees:function(t,e,n){n.endsWith("CCW")&&(e=e>0?e=-e:Math.abs(e));var i=Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),o=180*Math.atan2(t/i,e/i)/Math.PI+180;return"bearingCW"!==n&&"meteoCCW"!==n||(o+=180)>=360&&(o-=360),o},meterSec2Knots:function(t){return t/.514},meterSec2kilometerHour:function(t){return 3.6*t},_onMouseMove:function(t){var e,n=this,i=this.options.leafletVelocity._map.containerPointToLatLng(L.point(t.containerPoint.x,t.containerPoint.y)),o=this.options.leafletVelocity._windy.interpolatePoint(i.lng,i.lat);e=o&&!isNaN(o[0])&&!isNaN(o[1])&&o[2]?"<strong>"+this.options.velocityType+" Direction: </strong>"+n.vectorToDegrees(o[0],o[1],this.options.angleConvention).toFixed(2)+"Â°, <strong>"+this.options.velocityType+" Speed: </strong>"+n.vectorToSpeed(o[0],o[1],this.options.speedUnit).toFixed(2)+this.options.speedUnit:this.options.emptyString,n._container.innerHTML=e,0==$(".leaflet-control-velocity").index()&&$(".leaflet-control-velocity").insertAfter(".leaflet-control-mouseposition")}}),L.Map.mergeOptions({positionControl:!1}),L.Map.addInitHook((function(){this.options.positionControl&&(this.positionControl=new L.Control.MousePosition,this.addControl(this.positionControl))})),L.control.velocity=function(t){return new L.Control.Velocity(t)},L.VelocityLayer=(L.Layer?L.Layer:L.Class).extend({options:{displayValues:!0,displayOptions:{velocityType:"Velocity",position:"bottomleft",emptyString:"No velocity data"},maxVelocity:10,colorScale:null,data:null},_map:null,_canvasLayer:null,_windy:null,_context:null,_timer:0,_mouseControl:null,initialize:function(t){L.setOptions(this,t)},onAdd:function(t){this._canvasLayer=L.canvasLayer().delegate(this),this._canvasLayer.addTo(t),this._map=t},onRemove:function(t){this._destroyWind()},setData:function(t){this.options.data=t,this._windy&&(this._windy.setData(t),this._clearAndRestart()),this.fire("load")},onDrawLayer:function(t,e){var n=this;this._windy?this.options.data&&(this._timer&&clearTimeout(n._timer),this._timer=setTimeout((function(){n._startWindy()}),750)):this._initWindy(this)},_startWindy:function(){var t=this._map.getBounds(),e=this._map.getSize();this._windy.start([[0,0],[e.x,e.y]],e.x,e.y,[[t._southWest.lng,t._southWest.lat],[t._northEast.lng,t._northEast.lat]])},_initWindy:function(e){var n=Object.assign({canvas:e._canvasLayer._canvas},e.options);this._windy=new t(n),this._context=this._canvasLayer._canvas.getContext("2d"),this._canvasLayer._canvas.classList.add("velocity-overlay"),this.onDrawLayer(),this._map.on("dragstart",e._windy.stop),this._map.on("dragend",e._clearAndRestart),this._map.on("zoomstart",e._windy.stop),this._map.on("zoomend",e._clearAndRestart),this._map.on("resize",e._clearWind),this._initMouseHandler()},_initMouseHandler:function(){if(!this._mouseControl&&this.options.displayValues){var t=this.options.displayOptions||{};t.leafletVelocity=this,this._mouseControl=L.control.velocity(t).addTo(this._map)}},_clearAndRestart:function(){this._context&&this._context.clearRect(0,0,3e3,3e3),this._windy&&this._startWindy()},_clearWind:function(){this._windy&&this._windy.stop(),this._context&&this._context.clearRect(0,0,3e3,3e3)},_destroyWind:function(){this._timer&&clearTimeout(this._timer),this._windy&&this._windy.stop(),this._context&&this._context.clearRect(0,0,3e3,3e3),this._mouseControl&&this._map.removeControl(this._mouseControl),this._mouseControl=null,this._windy=null,this._map.removeLayer(this._canvasLayer)}}),L.velocityLayer=function(t){return new L.VelocityLayer(t)};var t=function(t){var e,n,i,o,a,r,s,h,l,c,u=t.minVelocity||0,d=t.maxVelocity||10,m=(t.velocityScale||.005)*(Math.pow(window.devicePixelRatio,1/3)||1),f=t.particleAge||90,p=t.lineWidth||1,_=t.particleMultiplier||1/300,y=Math.pow(window.devicePixelRatio,1/3)||1.6,v=1e3/(t.frameRate||15),g=t.colorScale||["rgb(36,104, 180)","rgb(60,157, 194)","rgb(128,205,193 )","rgb(151,218,168 )","rgb(198,231,181)","rgb(238,247,217)","rgb(255,238,159)","rgb(252,217,125)","rgb(255,182,100)","rgb(252,150,75)","rgb(250,112,52)","rgb(245,64,32)","rgb(237,45,28)","rgb(220,24,32)","rgb(180,0,35)"],L=[NaN,NaN,null],M=t.data,w=function(t,e,n,i,o,a){var r=1-t,s=1-e,h=r*s,l=t*s,c=r*e,u=t*e,d=n[0]*h+i[0]*l+o[0]*c+a[0]*u,m=n[1]*h+i[1]*l+o[1]*c+a[1]*u;return[d,m,Math.sqrt(d*d+m*m)]},x=function(t,i){if(!n)return null;var h,l=b(t-o,360)/r,c=(a-i)/s,u=Math.floor(l),d=u+1,m=Math.floor(c),f=m+1;if(h=n[m]){var p=h[u],_=h[d];if(C(p)&&C(_)&&(h=n[f])){var y=h[u],v=h[d];if(C(y)&&C(v))return e.interpolate(l-u,c-m,p,_,y,v)}}return null},C=function(t){return null!=t},b=function(t,e){return t-e*Math.floor(t/e)},T=function(t,e,n,i,o,a,r,s){var h=r[0]*a,l=r[1]*a,c=D(t,e,n,i,o,s);return r[0]=c[0]*h+c[2]*l,r[1]=c[1]*h+c[3]*l,r},D=function(t,e,n,i,o,a){var r=2*Math.PI,s=Math.pow(10,-5.2),h=e<0?s:-s,l=n<0?s:-s,c=W(n,e+h,a),u=W(n+l,e,a),d=Math.cos(n/360*r);return[(c[0]-i)/h/d,(c[1]-o)/h/d,(u[0]-i)/l,(u[1]-o)/l]},P=function(t,e,n){function i(e,n){var i=t[Math.round(e)];return i&&i[Math.round(n)]||L}i.release=function(){t=[]},i.randomize=function(t){var n,o,a=0;do{n=Math.round(Math.floor(Math.random()*e.width)+e.x),o=Math.round(Math.floor(Math.random()*e.height)+e.y)}while(null===i(n,o)[2]&&a++<30);return t.x=n,t.y=o,t},n(e,i)},z=function(t){return t/180*Math.PI},S=function(t){return t/(Math.PI/180)},R=function(t,e,n){var i=n.east-n.west,o=n.width/S(i)*360/(2*Math.PI),a=o/2*Math.log((1+Math.sin(n.south))/(1-Math.sin(n.south))),r=(n.height+a-e)/o,s=180/Math.PI*(2*Math.atan(Math.exp(r))-Math.PI/2);return[S(n.west)+t/n.width*S(i),s]},A=function(t){return Math.log(Math.tan(t/2+Math.PI/4))},W=function(t,e,n){var i=A(n.south),o=A(n.north),a=n.width/(n.east-n.west),r=n.height/(o-i),s=A(z(t));return[(z(e)-n.west)*a,s=(o-s)*r]},U=function(){k.field&&k.field.release(),c&&cancelAnimationFrame(c)},k={params:t,start:function(L,C,b,D){var S={south:z(D[0][1]),north:z(D[1][1]),east:z(D[1][0]),west:z(D[0][0]),width:C,height:b};U(),function(M,D){var z=(e=function(t){var e=null,n=null;return t.forEach((function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":e=t;break;case"1,3":case"2,3":n=t}})),function(t,e){var n=t.data,i=e.data;return{header:t.header,data:function(t){return[n[t],i[t]]},interpolate:w}}(e,n)}(M)).header;o=z.lo1,a=z.la1,r=z.dx,s=z.dy,h=z.nx,l=z.ny,(i=new Date(z.refTime)).setHours(i.getHours()+z.forecastTime),n=[];for(var A=0,W=Math.floor(h*r)>=360,U=0;U<l;U++){for(var N=[],F=0;F<h;F++,A++)N[F]=e.data(A);W&&N.push(N[0]),n[U]=N}!function(e){!function(t,e,n,i){var o={},a=(n.south-n.north)*(n.west-n.east),r=m*Math.pow(a,.4),s=[],h=e.x;function l(i){for(var a=[],h=e.y;h<=e.yMax;h+=2){var l=R(i,h,n);if(l){var c=l[0],u=l[1];if(isFinite(c)){var d=t.interpolate(c,u);d&&(d=T(o,c,u,i,h,r,d,n),a[h+1]=a[h]=d)}}}s[i+1]=s[i]=a}!function t(){for(var n=Date.now();h<e.width;)if(l(h),h+=2,Date.now()-n>1e3)return void setTimeout(t,25);P(s,e,i)}()}(e,function(t,e,n){var i=t[0],o=t[1],a=Math.round(i[0]),r=Math.max(Math.floor(i[1],0),0);return Math.min(Math.ceil(o[0],e),e-1),{x:a,y:r,xMax:e,yMax:Math.min(Math.ceil(o[1],n),n-1),width:e,height:n}}(L,C,b),S,(function(e,n){k.field=n,function(e,n){var i,o,a=(i=u,o=d,g.indexFor=function(t){return Math.max(0,Math.min(g.length-1,Math.round((t-i)/(o-i)*(g.length-1))))},g),r=a.map((function(){return[]})),s=Math.round(e.width*e.height*_);/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)&&(s*=y);for(var h=[],l=0;l<s;l++)h.push(n.randomize({age:Math.floor(Math.random()*f)+0}));var m=t.canvas.getContext("2d");m.lineWidth=p,m.fillStyle="rgba(0, 0, 0, 0.97)",m.globalAlpha=.6;var L=Date.now();!function t(){c=requestAnimationFrame(t);var i=Date.now(),o=i-L;o>v&&(L=i-o%v,r.forEach((function(t){t.length=0})),h.forEach((function(t){t.age>f&&(n.randomize(t).age=0);var e=t.x,i=t.y,o=n(e,i),s=o[2];if(null===s)t.age=f;else{var h=e+o[0],l=i+o[1];null!==n(h,l)[2]?(t.xt=h,t.yt=l,r[a.indexFor(s)].push(t)):(t.x=h,t.y=l)}t.age+=1})),m.globalCompositeOperation="destination-in",m.fillRect(e.x,e.y,e.width,e.height),m.globalCompositeOperation="lighter",m.globalAlpha=.9,r.forEach((function(t,e){t.length>0&&(m.beginPath(),m.strokeStyle=a[e],t.forEach((function(t){m.moveTo(t.x,t.y),m.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt})),m.stroke())})))}()}(e,n)}))}({date:i,interpolate:x})}(M)},stop:U,createField:P,interpolatePoint:x,setData:function(t){M=t}};return k};window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}}]);